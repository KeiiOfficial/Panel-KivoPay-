<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mode Nembak: Cinematic</title>
<style>
  :root{
    --bg:#060714;
    --txt:#eaf0ff;
    --mut:#aab4d6;
    --line:rgba(255,255,255,.12);
    --card:rgba(255,255,255,.06);
    --acc:#7c5cff;
    --good:#31ff8a;
    --bad:#ff3b5c;
    --warn:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:system-ui,Segoe UI,Roboto,Arial;
    color:var(--txt);
    background:
      radial-gradient(900px 520px at 20% 10%, rgba(124,92,255,.18), transparent 55%),
      radial-gradient(700px 420px at 85% 15%, rgba(49,255,138,.10), transparent 60%),
      radial-gradient(700px 420px at 35% 95%, rgba(255,59,92,.10), transparent 60%),
      var(--bg);
    overflow:hidden;
  }

  /* background FX */
  .grain{
    position:fixed; inset:-40%;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
    opacity:.10;
    transform:rotate(8deg);
    pointer-events:none;
    animation: drift 10s linear infinite;
考虑;
  }
  @keyframes drift{0%{transform:translate3d(-2%, -2%, 0) rotate(8deg)}100%{transform:translate3d(2%, 2%, 0) rotate(8deg)}}

  canvas{position:fixed; inset:0; pointer-events:none}

  /* layout */
  .hud{
    position:fixed; left:14px; right:14px; top:14px;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; z-index:50;
    font-size:12px; color:rgba(255,255,255,.55);
  }
  .hud .left{display:flex; gap:10px; align-items:center}
  .pill{
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.25);
    padding:6px 10px; border-radius:999px;
    backdrop-filter: blur(8px);
  }
  .bar{
    height:8px; width:min(280px, 48vw);
    border:1px solid rgba(255,255,255,.12);
    border-radius:999px;
    background:rgba(255,255,255,.06);
    overflow:hidden;
  }
  .bar > i{
    display:block; height:100%;
    width:0%;
    background:linear-gradient(90deg, rgba(124,92,255,.9), rgba(49,255,138,.8));
    transition:width .6s ease;
  }

  .stage{
    position:relative;
    height:100%;
    display:grid;
    place-items:center;
    padding:24px;
    z-index:10;
  }

  .scene{
    width:min(860px, 94vw);
    min-height:420px;
    border:1px solid var(--line);
    background:rgba(0,0,0,.35);
    border-radius:24px;
    box-shadow:0 30px 110px rgba(0,0,0,.55);
    backdrop-filter: blur(10px);
    padding:18px 18px 16px;
    position:absolute;
    opacity:0;
    transform:translateY(18px) scale(.98);
    pointer-events:none;
    transition:opacity .45s ease, transform .45s ease;
  }
  .scene.active{
    opacity:1;
    transform:translateY(0) scale(1);
    pointer-events:auto;
  }

  .top{
    display:flex; justify-content:space-between; align-items:center; gap:10px;
    padding-bottom:12px; border-bottom:1px solid var(--line);
  }
  .dots{display:flex; gap:6px; align-items:center}
  .dot{width:10px;height:10px;border-radius:99px;background:rgba(255,255,255,.14)}
  .dot.red{background:rgba(255,59,92,.5)}
  .dot.yel{background:rgba(255,209,102,.45)}
  .dot.gre{background:rgba(49,255,138,.45)}
  .title{
    font-weight:700; letter-spacing:.2px;
    display:flex; align-items:center; gap:10px;
  }
  .badge{
    font-size:12px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    padding:6px 10px; border-radius:999px;
    color:rgba(255,255,255,.75);
  }

  /* buttons */
  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
  button{
    border:none;
    padding:12px 14px;
    border-radius:16px;
    color:var(--txt);
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12);
    cursor:pointer;
    font-weight:700;
    transition:transform .12s ease, filter .12s ease;
    user-select:none;
  }
  button:hover{transform:translateY(-1px); filter:brightness(1.08)}
  .primary{border-color:rgba(124,92,255,.35); background:rgba(124,92,255,.12)}
  .good{border-color:rgba(49,255,138,.35); background:rgba(49,255,138,.12)}
  .bad{border-color:rgba(255,59,92,.35); background:rgba(255,59,92,.12)}
  .ghost{opacity:.9}

  /* typography */
  h1,h2{margin:14px 0 8px}
  h1{font-size:30px}
  h2{font-size:22px}
  p{margin:0; color:var(--mut); line-height:1.7}
  .big{font-size:16px; color:#d9e3ff}
  .mut{color:rgba(255,255,255,.55)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

  /* scene 1: glitch */
  .glitch{
    position:relative;
    font-weight:900;
    letter-spacing:.8px;
    text-transform:uppercase;
    font-size:34px;
    line-height:1.1;
    margin:24px 0 10px;
  }
  .glitch:before,.glitch:after{
    content:attr(data-text);
    position:absolute; left:0; top:0;
    width:100%;
    opacity:.6;
    clip-path: inset(0 0 0 0);
  }
  .glitch:before{
    transform:translate(2px, -1px);
    color:rgba(124,92,255,.9);
    animation:gl1 1.6s infinite linear;
  }
  .glitch:after{
    transform:translate(-2px, 1px);
    color:rgba(49,255,138,.75);
    animation:gl2 1.2s infinite linear;
  }
  @keyframes gl1{
    0%{clip-path: inset(0 0 85% 0)}
    20%{clip-path: inset(10% 0 65% 0)}
    40%{clip-path: inset(55% 0 20% 0)}
    60%{clip-path: inset(25% 0 55% 0)}
    80%{clip-path: inset(70% 0 10% 0)}
    100%{clip-path: inset(0 0 85% 0)}
  }
  @keyframes gl2{
    0%{clip-path: inset(80% 0 0 0)}
    25%{clip-path: inset(60% 0 10% 0)}
    50%{clip-path: inset(35% 0 35% 0)}
    75%{clip-path: inset(15% 0 60% 0)}
    100%{clip-path: inset(80% 0 0 0)}
  }
  /* scene 2: scanner */
  .scanWrap{
    margin-top:14px;
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    background:rgba(255,255,255,.04);
    overflow:hidden;
    position:relative;
  }
  .scanRow{display:flex; justify-content:space-between; padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.08)}
  .scanRow:last-child{border-bottom:none}
  .scanRow b{color:#d9e3ff}
  .scan{
    position:absolute; left:0; right:0; height:2px;
    background:linear-gradient(90deg, transparent, rgba(49,255,138,.9), transparent);
    top:0;
    animation:scan 1.4s infinite ease-in-out;
    opacity:.85;
  }
  @keyframes scan{0%{transform:translateY(0)}100%{transform:translateY(240px)}}

  /* scene 3: chat */
  .chat{
    margin-top:14px;
    display:flex; flex-direction:column; gap:10px;
  }
  .bubble{
    max-width:78%;
    padding:12px 14px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    color:#d9e3ff;
    transform:translateY(10px);
    opacity:0;
    animation: pop .45s ease forwards;
  }
  .bubble.me{align-self:flex-end; border-color:rgba(124,92,255,.25); background:rgba(124,92,255,.10)}
  .bubble.her{align-self:flex-start; border-color:rgba(49,255,138,.20); background:rgba(49,255,138,.08)}
  @keyframes pop{to{transform:translateY(0);opacity:1}}
  .typing{display:flex; gap:6px; align-items:center; margin-top:8px; color:rgba(255,255,255,.45); font-size:12px}
  .dotty i{width:6px;height:6px;border-radius:50%; background:rgba(255,255,255,.35); display:inline-block; animation: b 1.1s infinite}
  .dotty i:nth-child(2){animation-delay:.15s}
  .dotty i:nth-child(3){animation-delay:.3s}
  @keyframes b{0%,100%{transform:translateY(0);opacity:.4}50%{transform:translateY(-4px);opacity:1}}

  /* scene 4: memory cards */
  .memGrid{
    margin-top:14px;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
  }
  @media (max-width:740px){.memGrid{grid-template-columns:1fr}}
  .mem{
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.05);
    border-radius:18px;
    padding:12px;
    transform:translateY(12px);
    opacity:0;
    animation: up .5s ease forwards;
  }
  .mem:nth-child(2){animation-delay:.12s}
  .mem:nth-child(3){animation-delay:.24s}
  @keyframes up{to{transform:translateY(0);opacity:1}}
  .mem .k{font-size:12px; color:rgba(255,255,255,.55)}
  .mem .v{margin-top:6px; color:#d9e3ff; line-height:1.5}
  .mem .tag2{
    display:inline-block; margin-top:10px;
    font-size:12px; padding:5px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    color:rgba(255,255,255,.70);
    background:rgba(0,0,0,.20);
  }

  /* scene 5: question */
  .qBox{
    margin-top:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.30);
    border-radius:20px;
    padding:14px;
    position:relative;
    overflow:hidden;
  }
  .qBox:before{
    content:"";
    position:absolute; inset:-50%;
    background:conic-gradient(from 180deg, rgba(124,92,255,.18), rgba(49,255,138,.12), rgba(255,59,92,.12), rgba(124,92,255,.18));
    animation:spin 6s linear infinite;
    opacity:.6;
  }
  .qBox > div{position:relative}
  @keyframes spin{to{transform:rotate(360deg)}}

  .btnArea{position:relative; margin-top:12px; min-height:56px}
  .btnNo{position:absolute; left:160px; top:0}

  .shake{animation:shake .22s linear}
  @keyframes shake{
    0%{transform:translateX(0)}
    25%{transform:translateX(-6px)}
    50%{transform:translateX(6px)}
    75%{transform:translateX(-4px)}
    100%{transform:translateX(0)}
  }

  /* scene 6: ending */
  .center{
    text-align:center;
    padding:18px 10px;
  }
  .heart{
    width:76px;height:76px; margin:10px auto 0;
    filter:drop-shadow(0 20px 40px rgba(255,59,92,.18));
    animation:heart 1.2s infinite ease-in-out;
  }
  @keyframes heart{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

  /* helper */
  .type{
    display:inline-block;
    border-right:2px solid rgba(255,255,255,.45);
    padding-right:6px;
    animation: caret .8s steps(1) infinite;
  }
  @keyframes caret{50%{border-color:transparent}}
</style>
</head>
<body>
<div class="grain"></div>
<canvas id="fx"></canvas>

<div class="hud">
  <div class="left">
    <span class="pill mono" id="sceneName">SCENE 01</span>
    <span class="pill" id="hint">Klik Next. Jangan sok misterius.</span>
  </div>
  <div class="left" style="justify-content:flex-end">
    <div class="bar" title="progress"><i id="bar"></i></div>
    <span class="pill mono" id="pct">0%</span>
  </div>
</div>

<div class="stage">

  <!-- SCENE 1 -->
  <section class="scene active" data-name="SCENE 01" id="s1">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Init</span>
      </div>
      <span class="badge mono">CINEMATIC MODE</span>
    </div>

    <div style="padding:4px 6px 0">
      <div class="glitch" data-text="GUE MAU NGOMONG SESUATU.">GUE MAU NGOMONG SESUATU.</div>
      <p class="big">Tenang, ini bukan prank. Ini <b>jujur</b>.</p>
      <p class="mut" style="margin-top:10px">Kalau lo baca sampai akhir, berarti lo minimal punya rasa penasaran. Bagus.</p>
      <div class="actions">
        <button class="primary" data-next>Next</button>
        <button class="ghost" id="skip">Skip animasi (buat yang gak sabaran)</button>
      </div>
    </div>
  </section>

  <!-- SCENE 2 -->
  <section class="scene" data-name="SCENE 02" id="s2">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Scan</span>
      </div>
      <span class="badge mono" id="scanStatus">SCANNING...</span>
    </div>

    <h2>Analisa singkat (biar keliatan niat)</h2>
    <p>Gue gak mau sok puitis. Gue cuma mau jelas dan gak ngeselin.</p>

    <div class="scanWrap">
      <div class="scan"></div>
      <div class="scanRow"><span><b>Keberanian</b></span><span class="mono" id="a1">...</span></div>
      <div class="scanRow"><span><b>Niat</b></span><span class="mono" id="a2">...</span></div>
      <div class="scanRow"><span><b>Kepastian</b></span><span class="mono" id="a3">...</span></div>
      <div class="scanRow"><span><b>Keseriusan</b></span><span class="mono" id="a4">...</span></div>
    </div>

    <div class="actions">
      <button class="primary" data-next id="next2" disabled>Next</button>
    </div>
  </section>

  <!-- SCENE 3 -->
  <section class="scene" data-name="SCENE 03" id="s3">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Chat</span>
      </div>
      <span class="badge">no cringe (usaha)</span>
    </div>

    <h2>Gue latihan ngomong dulu</h2>
    <p class="mut">Biar pas ngomong beneran gak kayak orang kehabisan sinyal.</p>

    <div class="chat" id="chat"></div>

    <div class="actions">
      <button class="primary" data-next>Next</button>
    </div>
  </section>

  <!-- SCENE 4 -->
  <section class="scene" data-name="SCENE 04" id="s4">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Memori</span>
      </div>
      <span class="badge mono">3 HAL SIMPLE</span>
    </div>

    <h2>Kenapa gue berani ngomong?</h2>
    <p>Karena ini bukan “tiba-tiba”, ini akumulasi hal kecil.</p>

    <div class="memGrid">
      <div class="mem">
        <div class="k">01</div>
        <div class="v">Gue nyaman kalau ngobrol sama lo. Rasanya tenang, gak dibuat capek.</div>
        <span class="tag2">real</span>
      </div>
      <div class="mem">
        <div class="k">02</div>
        <div class="v">Lo punya cara sendiri bikin hari biasa jadi agak mendingan.</div>
        <span class="tag2">simple</span>
      </div>
      <div class="mem">
        <div class="k">03</div>
        <div class="v">Gue suka vibe lo. Bukan karena sempurna, tapi karena cocok.</div>
        <span class="tag2">jujur</span>
      </div>
    </div>

    <div class="actions">
      <button class="primary" data-next>Next</button>
    </div>
  </section>

  <!-- SCENE 5 -->
  <section class="scene" data-name="SCENE 05" id="s5">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Pertanyaan</span>
      </div>
      <span class="badge" id="lock">FINAL</span>
    </div>

    <h2 class="mono">Oke. Ini intinya.</h2>
    <div class="qBox">
      <div>
        <p class="big">Lo mau jadi pacar gue?</p>
        <p class="mut">Kalau nolak pun gue tetap hormat. Gue gak mau maksa, gue cuma mau jujur.</p>

        <div class="btnArea" id="btnArea">
          <button class="good" id="yes">IYA</button>
          <button class="bad btnNo" id="no">ENGGAK</button>
        </div>

        <p class="mut" id="tease" style="margin-top:12px">Klik “Enggak” kalau beneran berani.</p>
      </div>
    </div>
  </section>

  <!-- SCENE 6A: YES -->
  <section class="scene" data-name="SCENE 06" id="s6yes">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Result</span>
      </div>
      <span class="badge mono">YES</span>
    </div>

    <div class="center">
      <svg class="heart" viewBox="0 0 24 24" fill="none">
        <path d="M12 21s-7-4.7-9.5-8.5C.2 9.1 2 5.8 5.3 5.2c1.8-.4 3.6.3 4.7 1.7 1.1-1.4 2.9-2.1 4.7-1.7 3.3.6 5.1 3.9 2.8 7.3C19 16.3 12 21 12 21z"
          stroke="rgba(255,255,255,.85)" stroke-width="1.6"/>
      </svg>
      <h1>Deal.</h1>
      <p class="big">Gue gak janji jadi yang paling sempurna. Tapi gue janji <b>niat</b> dan gak main-main.</p>
      <p class="mut" style="margin-top:10px">Sekarang senyum dulu. Biar gak kaku kayak robot.</p>

      <div class="actions" style="justify-content:center">
        <button class="primary" id="replay">Replay</button>
      </div>
    </div>
  </section>

  <!-- SCENE 6B: NO -->
  <section class="scene" data-name="SCENE 06" id="s6no">
    <div class="top">
      <div class="title">
        <div class="dots"><span class="dot red"></span><span class="dot yel"></span><span class="dot gre"></span></div>
        <span>Result</span>
      </div>
      <span class="badge mono">NO</span>
    </div>

    <div class="center">
      <h1>Oke, gue terima.</h1>
      <p class="big">Makasih udah jujur. Gue gak bakal drama, gak bakal maksa.</p>
      <p class="mut" style="margin-top:10px">Minimal gue udah ngomong. Itu udah menang versi gue.</p>

      <div class="actions" style="justify-content:center">
        <button class="primary" id="replay2">Replay</button>
      </div>
    </div>
  </section>

</div>

<script>
  // ====== tiny helpers
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const scenes = $$(".scene");
  const bar = $("#bar"), pct = $("#pct"), sceneName = $("#sceneName"), hint = $("#hint");

  let idx = 0;
  function setProgress(){
    const p = Math.round((idx/(scenes.length-1))*100);
    bar.style.width = p+"%";
    pct.textContent = p+"%";
    sceneName.textContent = scenes[idx].dataset.name || ("SCENE " + String(idx+1).padStart(2,"0"));
  }
  function go(i){
    scenes[idx].classList.remove("active");
    idx = i;
    scenes[idx].classList.add("active");
    setProgress();
  }
  function next(){
    if(idx < 4) go(idx+1);
  }
  document.addEventListener("click",(e)=>{
    const btn = e.target.closest("[data-next]");
    if(btn) next();
  });

  // ====== Scene 2: fake scan numbers (auto enable next)
  const scanVals = [
    ["a1","78%"],["a2","93%"],["a3","100%"],["a4","88%"]
  ];
  let scanStep = 0;
  function runScan(){
    $("#scanStatus").textContent = "SCANNING...";
    scanStep = 0;
    const t = setInterval(()=>{
      const [id,val] = scanVals[scanStep];
      $("#"+id).textContent = val;
      scanStep++;
      if(scanStep >= scanVals.length){
        clearInterval(t);
        $("#scanStatus").textContent = "DONE";
        $("#next2").disabled = false;
        hint.textContent = "Udah, lanjut. Jangan pura-pura kuat.";
      }
    }, 650);
  }
 // when scene 2 becomes active
  const obs = new MutationObserver(()=>{
    if($("#s2").classList.contains("active")){
      // reset
      ["a1","a2","a3","a4"].forEach(id=>$("#"+id).textContent="...");
      $("#next2").disabled = true;
      runScan();
    }
    if($("#s3").classList.contains("active")){
      buildChat();
    }
  });
  obs.observe(document.body, {attributes:true, subtree:true, attributeFilter:["class"]});

  // ====== Scene 3: chat bubbles one by one
  let chatBuilt = false;
  function buildChat(){
    if(chatBuilt) return;
    chatBuilt = true;
    const chat = $("#chat");
    const lines = [
      {who:"me", text:"Gue mau ngomong sesuatu yang penting."},
      {who:"her", text:"Kenapa? kok serius amat?"},
      {who:"me", text:"Soalnya gue gak mau nyimpen doang dan sok santai."},
      {who:"me", text:"Gue nyaman sama lo. Dan itu bukan hal kecil buat gue."},
      {who:"her", text:"...lanjut."},
      {who:"me", text:"Makanya gue bikin ini. Biar jelas. Biar gak setengah-setengah."},
    ];

    let i = 0;
    const push = ()=>{
      if(i >= lines.length){
        const typing = document.createElement("div");
        typing.className = "typing";
        typing.innerHTML = `<span class="mut">Typing</span> <span class="dotty"><i></i><i></i><i></i></span>`;
        chat.appendChild(typing);
        setTimeout(()=>typing.remove(), 1100);
        return;
      }
      const b = document.createElement("div");
      b.className = "bubble " + (lines[i].who === "me" ? "me" : "her");
      b.style.animationDelay = "0ms";
      b.textContent = lines[i].text;
      chat.appendChild(b);
      i++;
      setTimeout(push, 600);
    };
    push();
  }

  // ====== Scene 5: No button dodge + route endings
  const btnArea = $("#btnArea");
  const no = $("#no");
  const yes = $("#yes");
  const tease = $("#tease");
  let dodge = 0;

  function moveNo(){
    dodge++;
    const r = btnArea.getBoundingClientRect();
    const w = 110, h = 48;
    const maxX = Math.max(0, r.width - w);
    const maxY = Math.max(0, r.height - h);

    btnArea.style.minHeight = "130px";

    const x = Math.random()*maxX;
    const y = Math.random()*maxY;

    no.style.left = x + "px";
    no.style.top  = y + "px";

    $("#s5").classList.add("shake");
    setTimeout(()=>$("#s5").classList.remove("shake"), 220);

    if(dodge === 1) tease.textContent = "Masih ragu? wajar. Tapi jangan kabur.";
    if(dodge === 3) tease.textContent = "Tombol Enggak kayak sinyal. Susah ditangkep.";
    if(dodge === 6) tease.textContent = "Oke cukup. Kalau gak mau, bilang aja pelan-pelan.";
    if(dodge >= 9){
      tease.textContent = "Udah. Gue anggap itu jawaban. Gapapa.";
      // allow click no for real after 9 dodges
      no.removeEventListener("mouseenter", moveNo);
      no.removeEventListener("click", moveNo);
      no.addEventListener("click", ()=>goToNo());
    }
  }

  function goToYes(){
    go(5); // s6yes index in our order? careful: scenes include s1..s6no
    // find exact index by id
    go(scenes.findIndex(s=>s.id==="s6yes"));
    confettiBoom();
  }
  function goToNo(){
    go(scenes.findIndex(s=>s.id==="s6no"));
  }

  yes.addEventListener("click", goToYes);

  // dodge starts when s5 active
  function armDodge(){
    dodge = 0;
    btnArea.style.minHeight = "56px";
    no.style.left = "160px";
    no.style.top = "0px";
    tease.textContent = "Klik “Enggak” kalau beneran berani.";
    no.addEventListener("mouseenter", moveNo);
    no.addEventListener("click", moveNo);
  }
  // monitor when s5 active
  setInterval(()=>{
    if($("#s5").classList.contains("active") && !no.dataset.armed){
      no.dataset.armed = "1";
      armDodge();
      hint.textContent = "Nah ini. Jangan panik.";
    }
  }, 200);

  // ====== controls
  $("#skip").addEventListener("click", ()=>{
    go(4); // jump to question scene
    hint.textContent = "Skip? Yaudah, versi pengecut cepat.";
  });

  $("#replay").addEventListener("click", ()=>location.reload());
  $("#replay2").addEventListener("click", ()=>location.reload());

  // initial progress
  setProgress();

  // ====== FX canvas: particles + confetti
  const c = $("#fx"), ctx = c.getContext("2d");
  function resize(){
    c.width = innerWidth * devicePixelRatio;
    c.height = innerHeight * devicePixelRatio;
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  addEventListener("resize", resize); resize();

  let sparks = [];
  function addSpark(x,y, n=14){
    for(let i=0;i<n;i++){
      sparks.push({
        x,y,
        vx:(Math.random()*2-1)*5,
        vy:(Math.random()*2-1)*5 - 2,
        life: 40 + Math.random()*25,
        t: 0
      });
    }
  }
  // gentle ambient sparks
  setInterval(()=>{
    if(idx <= 3) addSpark(Math.random()*innerWidth, Math.random()*innerHeight, 2);
  }, 280);

  // click sparks
  addEventListener("pointerdown",(e)=> addSpark(e.clientX, e.clientY, 10));

  function confettiBoom(){
    for(let i=0;i<140;i++){
      sparks.push({
        x: innerWidth/2,
        y: innerHeight*0.25,
        vx:(Math.random()*2-1)*10,
        vy:(Math.random()*2-1)*10 - 6,
        life: 90 + Math.random()*60,
        t: 0,
        conf:true,
        rot: Math.random()*Math.PI,
        vr:(Math.random()*2-1)*0.25
      });
    }
  }

  function tick(){
    ctx.clearRect(0,0,innerWidth,innerHeight);

    // draw
    for(let i=sparks.length-1;i>=0;i--){
      const p = sparks[i];
      p.t++;
      p.vy += p.conf ? 0.22 : 0.06;
      p.x += p.vx;
      p.y += p.vy;
      p.vx *= 0.985;
      p.vy *= 0.985;

      const a = Math.max(0, 1 - p.t/p.life);
      ctx.globalAlpha = a * (p.conf ? 0.95 : 0.55);

      if(p.conf){
        p.rot += p.vr;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = "white"; // no custom colors, keep it clean
        ctx.fillRect(-3, -2, 6, 4);
        ctx.restore();
      }else{
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(p.x, p.y, 1.4, 0, Math.PI*2);
        ctx.fill();
      }

      if(p.t >= p.life || p.y > innerHeight+40 || p.x<-40 || p.x>innerWidth+40){
        sparks.splice(i,1);
      }
    }

    requestAnimationFrame(tick);
  }
  tick();
</script>
</body>
</html> 
