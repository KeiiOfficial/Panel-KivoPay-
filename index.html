<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analisis Pesan Pasangan</title>
  <meta name="description" content="Analisis teks chat yang kamu tempel: tone, red flags, green flags, pola komunikasi. Semua lokal di browser." />
  <style>
    :root{
      --bg0:#070a12;
      --bg1:#0b1020;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.12);
      --txt:#eaf0ff;
      --mut:#aeb9d6;
      --acc:#8b5cf6;
      --acc2:#ec4899;
      --ok:#7cffb2;
      --bad:#ff7c9b;
      --warn:#ffd8a8;
      --shadow: 0 18px 56px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--txt);
      background:
        radial-gradient(900px 520px at 20% 15%, rgba(139,92,246,.26), transparent 55%),
        radial-gradient(850px 420px at 92% 20%, rgba(236,72,153,.18), transparent 55%),
        radial-gradient(700px 360px at 50% 95%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .center{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .card{
      width:min(720px, 100%);
      border-radius:24px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .bd{padding:16px}
    .brand{
      display:flex;align-items:center;gap:10px;
    }
    .logo{
      width:42px;height:42px;border-radius:16px;
      border:1px solid rgba(139,92,246,.45);
      background: radial-gradient(circle at 30% 30%, rgba(139,92,246,.95), rgba(236,72,153,.25));
      box-shadow: 0 10px 30px rgba(139,92,246,.20);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
    }
    .mut{color:var(--mut)}
    .btn{
      border:1px solid rgba(139,92,246,.45);
      background:rgba(139,92,246,.12);
      color:var(--txt);
      padding:11px 14px;
      border-radius:16px;
      cursor:pointer;
      font-weight:800;
      transition:transform .06s ease, filter .15s ease;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.06)}
    .btn:active{transform:scale(.985)}
    .btn.primary{
      border:0;
      background:linear-gradient(135deg, rgba(139,92,246,.98), rgba(236,72,153,.75));
      color:#0a0017;
      font-weight:900;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:9px 12px;border-radius:999px;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      color:var(--mut);
      font-size:12px;
      width:max-content;
    }
    .hr{height:1px;background:rgba(255,255,255,.10);margin:14px 0}
    .input, .ta, select{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25);
      color:var(--txt);
      outline:none;
      font-size:14px;
    }
    .ta{min-height:180px;resize:vertical;line-height:1.5}
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
    }
    @media (min-width: 940px){
      .grid{grid-template-columns: 1.1fr .9fr;}
    }
    .panel{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      border-radius:18px;
      padding:14px;
    }
    .kpi{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (min-width: 520px){ .kpi{grid-template-columns:1fr 1fr 1fr 1fr;} }
    .k{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      border-radius:16px;
      padding:10px;
    }
    .k b{display:block;font-size:12px;color:var(--mut);font-weight:800}
    .k span{font-size:18px;font-weight:950}
    .tag{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      color:var(--mut);
      font-size:12px;
      width:max-content;
      margin:4px 6px 0 0;
    }
    .tag.ok{border-color: rgba(124,255,178,.35); color: rgba(124,255,178,.95)}
    .tag.bad{border-color: rgba(255,124,155,.35); color: rgba(255,124,155,.95)}
    .tag.warn{border-color: rgba(255,216,168,.35); color: rgba(255,216,168,.95)}
    .small{font-size:12px;color:var(--mut);line-height:1.6}
    .title{
      font-size:22px;
      margin:0 0 8px;
      letter-spacing:.2px;
      font-weight:950;
    }

    /* Intro loading overlay */
    #intro{
      position:fixed; inset:0; z-index:999;
      display:flex; align-items:center; justify-content:center;
      padding:16px;
      background:
        radial-gradient(900px 520px at 20% 15%, rgba(139,92,246,.30), transparent 55%),
        radial-gradient(850px 420px at 92% 20%, rgba(236,72,153,.22), transparent 55%),
        linear-gradient(180deg, #070a12, #0b1020);
    }
    .loadCard{
      width:min(680px, 100%);
      border-radius:24px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .loadBody{padding:16px}
    .bar{
      width:100%; height:14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(139,92,246,.95), rgba(236,72,153,.75), rgba(255,255,255,.22));
      transition: width .06s linear;
    }
    .pct{
      margin-top:10px;
      display:flex; justify-content:space-between; align-items:center;
      color:var(--mut);
      font-size:12px;
    }
    .footer{
      padding:14px 16px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }
    .hide{display:none !important}
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      padding:10px 12px;
      border-radius:14px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.16);
      color:var(--txt);
      z-index:9999;
      max-width:min(520px, calc(100% - 30px));
      text-align:center;
      font-weight:700;
    }
  </style>
</head>

<body>
  <!-- Intro -->
  <div id="intro">
    <div class="loadCard">
      <div class="hd">
        <div class="brand">
          <div class="logo">M</div>
          <div>
            <b>Haii ini Mirayy!</b><br/>
            <span class="mut" style="font-size:12px">Web Analisis Pesan (paste teks, bukan nyolong chat)</span>
          </div>
        </div>
        <span class="chip">Mode: Lokal ‚úÖ</span>
      </div>
      <div class="loadBody">
        <p class="small" style="margin:0 0 12px">
          Selamat datang. Tempel chat yang kamu punya (dengan izin/akses yang sah), lalu aku bantu baca polanya:
          tone, red flags, green flags, dan saran respon.
        </p>

        <div class="bar"><div id="barFill"></div></div>
        <div class="pct">
          <span id="status">Menyiapkan modul analisis‚Ä¶</span>
          <span><b id="pctNum">1</b>%</span>
        </div>

        <div class="hr"></div>

        <div class="panel">
          <div class="small">
            <span style="color:var(--warn);font-weight:900">Catatan:</span>
            Ini cuma analisis teks, bukan ‚Äúkebenaran hubungan‚Äù. Kalau lu cari alat buat ngintip pasangan,
            cari masalah lain. Ini web buat bantu lu berpikir lebih jernih.
          </div>
        </div>
      </div>
      <div class="footer">
        <button class="btn" id="skipBtn" onclick="finishIntro()">Skip</button>
        <button class="btn primary" id="goBtn" onclick="finishIntro()" disabled>Lanjutkan ke Aplikasi</button>
      </div>
    </div>
  </div>

  <!-- App -->
  <div class="wrap" id="app" style="padding-top:18px">
    <div class="card">
      <div class="hd">
        <div class="brand">
          <div class="logo">M</div>
          <div>
            <b>Analisis Pesan Pasangan</b><br/>
            <span class="mut" style="font-size:12px">Tempel chat ‚Üí lihat pola ‚Üí ambil keputusan</span>
          </div>
        </div>
        <div class="row">
          <span class="chip">Tidak upload data</span>
          <button class="btn" onclick="loadExample()">Contoh</button>
          <button class="btn primary" onclick="run()">Analisis</button>
        </div>
      </div>

      <div class="bd">
        <div class="grid">
          <div class="panel">
            <h2 class="title">Input Chat</h2>
            <div class="row">
              <select id="mode">
                <option value="auto">Mode: Auto (deteksi umum)</option>
                <option value="id">Mode: Indonesia</option>
                <option value="mix">Mode: Campuran (ID + slang)</option>
              </select>
              <input class="input" id="you" placeholder="Nama kamu (opsional) contoh: Aku / Keii" />
              <input class="input" id="them" placeholder="Nama dia (opsional) contoh: Dia / Sayang" />
            </div>

            <div class="hr"></div>

            <textarea class="ta" id="text" placeholder="Paste chat di sini. Contoh:
Aku: kamu di mana?
Dia: nanti dulu, lagi sibuk.
Aku: iya, tapi jangan ngilang dong...
"></textarea>

            <div class="hr"></div>

            <div class="row">
              <button class="btn" onclick="clearAll()">Reset</button>
              <button class="btn" onclick="copyResult()">Copy Hasil</button>
              <button class="btn primary" onclick="run()">Analisis Sekarang</button>
            </div>

            <p class="small" style="margin:12px 0 0">
              Tips: kalau chat panjang, cukup ambil 30‚Äì80 baris terakhir biar analisisnya relevan.
            </p>
          </div>

          <div class="panel">
            <h2 class="title">Hasil</h2>

            <div class="kpi" id="kpi">
              <div class="k"><b>Tone Dominan</b><span id="tone">-</span></div>
              <div class="k"><b>Skor Negatif</b><span id="neg">-</span></div>
              <div class="k"><b>Skor Positif</b><span id="pos">-</span></div>
              <div class="k"><b>Level Risiko</b><span id="risk">-</span></div>
            </div>

            <div class="hr"></div>

            <div>
              <b>Tag</b><br/>
              <div id="tags" style="margin-top:6px"></div>
            </div>

            <div class="hr"></div>

            <div>
              <b>Ringkasan</b>
              <div class="small" id="summary" style="margin-top:8px">Belum ada analisis.</div>
            </div>

            <div class="hr"></div>

            <div>
              <b>Saran Respon (Contoh)</b>
              <div class="small" id="reply" style="margin-top:8px">-</div>
            </div>

            <div class="hr"></div>

            <div>
              <b>Highlight Kata/Pola</b>
              <div class="small" id="high" style="margin-top:8px">-</div>
            </div>
          </div>
        </div>
      </div>

      <div class="bd" style="padding-top:0">
        <div class="panel">
          <b>Privasi</b>
          <p class="small" style="margin:8px 0 0">
            Analisis berjalan di browser kamu. Tidak ada server, tidak ada ‚Äúsadap‚Äù.
            Kalau lu mau analisis yang lebih akurat (misal klasifikasi emosi lebih dalam),
            itu butuh AI online dan itu artinya data bisa keluar. Di sini sengaja enggak.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Intro loading 1-100% =====
    const barFill = document.getElementById('barFill');
    const pctNum  = document.getElementById('pctNum');
    const status  = document.getElementById('status');
    const goBtn   = document.getElementById('goBtn');

    let p = 1;
    const steps = [
      [15, "Menyiapkan modul analisis‚Ä¶"],
      [35, "Memuat kamus kata‚Ä¶"],
      [55, "Menyiapkan deteksi pola‚Ä¶"],
      [75, "Menyiapkan UI‚Ä¶"],
      [95, "Hampir siap‚Ä¶"],
      [100,"Siap."]
    ];
    const t = setInterval(()=>{
      p += Math.floor(Math.random()*3)+1;
      if(p>100) p=100;
      pctNum.textContent = p;
      barFill.style.width = p + "%";
      for(const [pt,msg] of steps){
        if(p<=pt){ status.textContent = msg; break; }
      }
      if(p>=100){
        clearInterval(t);
        goBtn.disabled = false;
      }
    }, 26);

    function finishIntro(){
      document.getElementById('intro').classList.add('hide');
    }

    // ===== Analysis engine (heuristic) =====
    const POS = [
      "makasih","terima kasih","thanks","maaf","sorry","sayang","cinta","kangen",
      "paham","ngerti","baik","support","tenang","aman","jujur","komit","serius",
      "mau denger","aku dengar","aku paham","aku ngerti","peluk","‚ù§Ô∏è","ü´∂","üòä"
    ];
    const NEG = [
      "anj","anjir","tolol","bodoh","bego","najis","kontol","bangsat","goblok",
      "capek","muak","males","ribet","berantem","berisik","drama",
      "udah","terserah","whatever","ga peduli","ngapain","sok","susah",
      "bohong","dibohongin","selingkuh","ghost","ngilang","cuek","dingin",
      "nanti","sibuk","ga bisa","gak bisa","ga mau","gak mau","jijik","malu"
    ];
    const REDFLAGS = [
      {k:["terserah","yaudah","udah lah"], t:"Stonewalling / pasif-agresif"},
      {k:["ngilang","ghost","diemin"], t:"Menghilang (avoidant)"},
      {k:["bohong","dibohongin","selingkuh"], t:"Kejujuran bermasalah"},
      {k:["tolol","goblok","bego","bodoh"], t:"Menghina / merendahkan"},
      {k:["ga peduli","gak peduli"], t:"Invalidasi / tidak peduli"},
      {k:["urus sendiri","bukan urusan aku"], t:"Lempar tanggung jawab"},
    ];
    const GREENFLAGS = [
      {k:["maaf","sorry"], t:"Ada effort memperbaiki"},
      {k:["aku paham","aku ngerti","paham"], t:"Validasi perasaan"},
      {k:["kita cari solusi","gimana kalau"], t:"Problem solving"},
      {k:["jujur","komit","serius"], t:"Niat jelas"},
    ];

    function norm(s){
      return (s||"").toLowerCase()
        .replace(/\s+/g,' ')
        .trim();
    }

    function countHits(text, list){
      let c=0;
      for(const w of list){
        const re = new RegExp(escapeReg(w), "g");
        const m = text.match(re);
        if(m) c += m.length;
      }
      return c;
    }

    function escapeReg(s){
      return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    function riskLevel(pos, neg, redCount){
      // skala kasar, karena hidup juga kasar
      const score = (neg*2) + (redCount*3) - (pos);
      if(score <= 2) return {label:"Rendah", cls:"ok"};
      if(score <= 7) return {label:"Sedang", cls:"warn"};
      return {label:"Tinggi", cls:"bad"};
    }

    function dominantTone(pos, neg){
      if(pos===0 && neg===0) return "Netral";
      if(pos > neg*1.2) return "Hangat";
      if(neg > pos*1.2) return "Tegang";
      return "Campur";
    }

    function findPatterns(text){
      const foundRed = [];
      for(const r of REDFLAGS){
        if(r.k.some(k => text.includes(k))) foundRed.push(r.t);
      }
      const foundGreen = [];
      for(const g of GREENFLAGS){
        if(g.k.some(k => text.includes(k))) foundGreen.push(g.t);
      }
      return {foundRed, foundGreen};
    }

    function highlight(text){
      const hits = [];
      const top = [...new Set([...NEG, ...POS])].slice(0, 80);
      for(const w of top){
        if(text.includes(w)) hits.push(w);
      }
      return hits.slice(0, 18);
    }

    function buildReply(tone, risk){
      if(risk === "Tinggi"){
        return `Kalimat aman: "Aku pengin kita ngobrol jelas. Kalau sekarang belum siap, bilang kapan bisa. Kalau tetap menghindar/menghina, aku bakal jaga jarak dulu."`;
      }
      if(tone === "Tegang"){
        return `Kalimat aman: "Aku nangkep kamu lagi nggak enak. Aku cuma butuh kejelasan: kamu maunya gimana dan kapan bisa ngobrol tanpa marah-marah?"`;
      }
      if(tone === "Hangat"){
        return `Kalimat aman: "Makasih udah jelasin. Biar makin jelas, kita sepakatin aturan komunikasi: kalau sibuk bilang estimasi, jangan ngilang."`;
      }
      return `Kalimat aman: "Aku butuh kejelasan biar nggak overthinking. Kamu bisa jelasin singkat sekarang atau tentuin waktu ngobrol?"`;
    }

    function tagHTML(label, type){
      const cls = type || "";
      return `<span class="tag ${cls}">${label}</span>`;
    }

    function run(){
      const raw = document.getElementById('text').value || "";
      const text = norm(raw);

      if(text.length < 10){
        toast("Tempel chat dulu. Ini bukan cenayang.");
        return;
      }

      const pos = countHits(text, POS);
      const neg = countHits(text, NEG);
      const {foundRed, foundGreen} = findPatterns(text);
      const tone = dominantTone(pos, neg);
      const risk = riskLevel(pos, neg, foundRed.length);

      // KPIs
      document.getElementById('tone').textContent = tone;
      document.getElementById('pos').textContent = String(pos);
      document.getElementById('neg').textContent = String(neg);
      document.getElementById('risk').textContent = risk.label;

      // Tags
      const tags = [];
      tags.push(tagHTML(`Tone: ${tone}`, tone==="Hangat" ? "ok" : (tone==="Tegang" ? "warn" : "")));
      tags.push(tagHTML(`Risiko: ${risk.label}`, risk.cls));
      if(foundGreen.length) tags.push(tagHTML(`Green: ${foundGreen.length}`, "ok"));
      if(foundRed.length) tags.push(tagHTML(`Red: ${foundRed.length}`, "bad"));

      // list items
      for(const g of foundGreen.slice(0,4)) tags.push(tagHTML(g, "ok"));
      for(const r of foundRed.slice(0,4)) tags.push(tagHTML(r, "bad"));
      document.getElementById('tags').innerHTML = tags.join("");

      // Summary
      const lines = [];
      if(tone==="Hangat") lines.push("Nada chat cenderung hangat. Masih ada ruang komunikasi sehat.");
      else if(tone==="Tegang") lines.push("Nada chat tegang. Kalau diterusin tanpa kontrol, ujungnya salah paham atau perang kecil.");
      else if(tone==="Campur") lines.push("Nada chat campur. Ada sisi baik, tapi ada pemicu konflik juga.");
      else lines.push("Nada chat netral. Belum cukup sinyal emosi dari teks.");

      if(foundRed.length){
        lines.push(`Terdeteksi beberapa red flag: ${foundRed.slice(0,3).join(", ")}${foundRed.length>3?"‚Ä¶":""}.`);
      } else {
        lines.push("Tidak ada red flag kuat dari kata kunci, tapi tetap lihat konteks.");
      }

      if(foundGreen.length){
        lines.push(`Ada green flag: ${foundGreen.slice(0,3).join(", ")}${foundGreen.length>3?"‚Ä¶":""}.`);
      } else {
        lines.push("Green flag belum keliatan kuat. Mungkin chatnya terlalu singkat atau lagi fase dingin.");
      }

      document.getElementById('summary').textContent = lines.join(" ");

      // Reply suggestion
      document.getElementById('reply').textContent = buildReply(tone, risk.label);

      // Highlights
      const h = highlight(text);
      document.getElementById('high').innerHTML = h.length
        ? h.map(w => tagHTML(w, POS.includes(w) ? "ok" : (NEG.includes(w) ? "bad" : ""))).join("")
        : "-";
    }

    function clearAll(){
      document.getElementById('text').value = "";
      document.getElementById('you').value = "";
      document.getElementById('them').value = "";
      document.getElementById('tone').textContent = "-";
      document.getElementById('pos').textContent = "-";
      document.getElementById('neg').textContent = "-";
      document.getElementById('risk').textContent = "-";
      document.getElementById('tags').innerHTML = "";
      document.getElementById('summary').textContent = "Belum ada analisis.";
      document.getElementById('reply').textContent = "-";
      document.getElementById('high').textContent = "-";
      toast("Reset.");
    }

    function loadExample(){
      document.getElementById('text').value =
`Aku: kamu di mana?
Dia: nanti dulu, lagi sibuk.
Aku: ya bilang dong, jangan ngilang.
Dia: terserah.
Aku: aku cuma minta kejelasan.
Dia: yaudah maaf, aku capek.`;
      toast("Contoh dimuat. Klik Analisis.");
    }

    function copyResult(){
      const tone = document.getElementById('tone').textContent;
      const pos  = document.getElementById('pos').textContent;
      const neg  = document.getElementById('neg').textContent;
      const risk = document.getElementById('risk').textContent;
      const summary = document.getElementById('summary').textContent;
      const reply = document.getElementById('reply').textContent;

      const out =
`HASIL ANALISIS PESAN
Tone: ${tone}
Positif: ${pos}
Negatif: ${neg}
Risiko: ${risk}

Ringkasan:
${summary}

Saran respon:
${reply}`;

      navigator.clipboard.writeText(out).then(()=>{
        toast("Hasil dicopy.");
      }).catch(()=>{
        toast("Gagal copy. Browser lu pelit izin clipboard.");
      });
    }

    function toast(msg){
      const t = document.createElement("div");
      t.className = "toast";
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(()=>t.remove(), 1400);
    }

    // expose
    window.finishIntro = finishIntro;
    window.run = run;
    window.clearAll = clearAll;
    window.copyResult = copyResult;
    window.loadExample = loadExample;
  </script>
</body>
</html>
