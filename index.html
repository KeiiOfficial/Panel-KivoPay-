<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KivoPay ‚Ä¢ Aplikasi Premium</title>
  <style>
    :root{
      --bg:#070a12;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.12);
      --text:#eef3ff;
      --muted:rgba(235,245,255,.72);
      --acc:#6ea8fe;
      --acc2:#00d2ff;

      --online:#12f37b;
      --offline:#ff4b4b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(900px 450px at 10% 10%, rgba(110,168,254,.18), transparent 60%),
        radial-gradient(900px 450px at 90% 20%, rgba(255,80,120,.10), transparent 60%),
        radial-gradient(900px 450px at 50% 90%, rgba(0,210,255,.10), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }

    /* slow color shift */
    .bgshift{
      position:fixed; inset:-25%;
      z-index:-1;
      background:
        radial-gradient(900px 520px at 20% 25%, rgba(18,243,123,.10), transparent 60%),
        radial-gradient(900px 520px at 80% 30%, rgba(255,75,75,.10), transparent 60%),
        linear-gradient(135deg, #070a12, #0a1030, #170a2a);
      filter: blur(18px) saturate(1.15);
      animation:bgShift 16s ease-in-out infinite alternate;
      opacity:.9;
    }
    @keyframes bgShift{
      0%{transform:scale(1) rotate(0deg)}
      100%{transform:scale(1.12) rotate(4deg)}
    }

    header{
      position:sticky; top:0; z-index:50;
      background:rgba(7,10,18,.65);
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar{
      max-width:980px; margin:0 auto;
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }
    .logo{
      width:38px;height:38px;border-radius:12px;
      display:grid; place-items:center;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 12px 35px rgba(0,0,0,.35);
      font-weight:900;
    }
    .brandtxt{min-width:0}
    .brandtxt b{display:block; font-size:14px; letter-spacing:.2px}
    .brandtxt span{
      display:block; font-size:12px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width:42vw;
    }

    .right{
      display:flex; align-items:center; gap:10px;
      flex-wrap:nowrap;
    }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--offline);
      position:relative;
    }
    .dot::after{
      content:"";
      position:absolute; inset:-10px;
      border-radius:50%;
      border:2px solid currentColor;
      opacity:.12;
      animation:ring 1.6s infinite;
    }
    @keyframes ring{
      0%{transform:scale(.3); opacity:.22}
      100%{transform:scale(1.1); opacity:0}
    }
    .pill.online .dot{background:var(--online); color:var(--online)}
    .pill.offline .dot{background:var(--offline); color:var(--offline)}
    .pill b{color:var(--text); font-weight:900}

    .wrap{max-width:980px; margin:0 auto; padding:14px}
    .typing{
      padding:10px 12px;
      border-radius:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 14px 50px rgba(0,0,0,.35);
      margin:12px 0;
      display:flex; align-items:center; gap:10px;
    }
    .typing .cursor{
      width:10px;height:20px;background:rgba(255,255,255,.65);
      border-radius:3px;
      animation:blink .8s steps(2) infinite;
    }
    @keyframes blink{50%{opacity:0}}
    .typing .text{
      font-weight:700;
      color:rgba(235,245,255,.92);
      font-size:13px;
      line-height:1.35;
    }

    .searchRow{
      display:flex; gap:10px; align-items:center;
      margin:12px 0 10px;
    }
    .search{
      flex:1;
      border:none;
      outline:none;
      color:var(--text);
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      padding:12px 12px;
      border-radius:16px;
      font-size:14px;
    }
    .btn{
      border:none; cursor:pointer;
      padding:12px 14px;
      border-radius:16px;
      font-weight:900;
      color:#07102a;
      background:linear-gradient(135deg,var(--acc),var(--acc2));
      box-shadow:0 18px 55px rgba(0,160,255,.25);
      transition:transform .12s ease, filter .12s ease;
      white-space:nowrap;
    }
    .btn:active{transform:scale(.99)}
    .btn:hover{filter:brightness(1.05)}
    .btn.ghost{
      background:rgba(255,255,255,.06);
      color:var(--text);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
    }

    .catCard{
      margin-top:10px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      padding:14px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .catCard .left h2{margin:0; font-size:18px; font-weight:1000}
    .catCard .left p{margin:4px 0 0; font-size:12px; color:var(--muted)}
    .catCard .count{font-size:12px; color:var(--muted); margin-top:4px; white-space:nowrap}

    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
      margin-top:12px;
    }
    @media(min-width:860px){
      .grid{grid-template-columns: repeat(3, minmax(0,1fr))}
    }
    .card{
      overflow:hidden;
      border-radius:22px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 16px 55px rgba(0,0,0,.35);
      display:flex; flex-direction:column;
      min-height:270px;
    }
    .imgWrap{
      height:150px;
      background:rgba(255,255,255,.03);
      display:grid; place-items:center;
      overflow:hidden;
    }
    .imgWrap img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      transform:scale(1.02);
    }
    .body{padding:12px}
    .name{font-weight:1000; font-size:14px; margin:0 0 6px}
    .desc{margin:0 0 10px; color:var(--muted); font-size:12px}
    .row{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .price{
      font-weight:1000; color:rgba(110,168,254,.95);
      font-size:14px;
    }
    .mini{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
    }

    /* footer note */
    .note{
      margin:16px 0 6px;
      padding:14px;
      border-radius:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:rgba(235,245,255,.88);
      line-height:1.6;
      font-size:13px;
    }
    .waTab{
      display:flex; gap:10px; flex-wrap:wrap;
      margin:10px 0 20px;
    }

    /* ===== MODALS ===== */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index:100;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(560px, 100%);
      max-height:86vh; /* IMPORTANT: scroll works */
      overflow:auto;
      background:rgba(10,14,28,.92);
      border:1px solid rgba(255,255,255,.12);
      border-radius:24px;
      box-shadow:0 30px 100px rgba(0,0,0,.65);
    }
    .mHead{
      position:sticky; top:0;
      background:rgba(10,14,28,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.10);
      padding:14px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      z-index:5;
    }
    .mHead b{font-size:15px}
    .x{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      font-size:18px;
    }
    .mBody{padding:14px}
    .field{
      display:flex; flex-direction:column; gap:7px; margin:10px 0;
    }
    .field label{font-size:12px; color:var(--muted); font-weight:800}
    .input, .select{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.28);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    .payRow{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .payBtn{
      display:flex; align-items:center; gap:10px;
      padding:12px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      cursor:pointer;
      color:var(--text);
      font-weight:1000;
      min-width:0;
    }
    .payBtn img{width:26px;height:26px;border-radius:10px;background:rgba(0,0,0,.2)}
    .payBtn small{display:block; font-weight:800; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .payBtn.active{
      border-color:rgba(110,168,254,.55);
      box-shadow:0 0 0 3px rgba(110,168,254,.16);
    }

    .qrisBox{
      margin-top:10px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
    }
    .qrisShow{
      width:100%;
      margin-top:8px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.07);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
    }

    .chk{
      display:flex; gap:10px; align-items:flex-start;
      margin:12px 0 8px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
    }
    .chk input{width:18px;height:18px;margin-top:2px}
    .chk b{display:block}
    .chk span{display:block; font-size:12px; color:var(--muted); margin-top:4px}

    .actions{
      display:flex; gap:10px; margin-top:10px;
    }
    .actions .btn, .actions .btn.ghost{flex:1}

    .helpSmall{
      font-size:12px; color:var(--muted); line-height:1.5;
      margin-top:8px;
    }

    /* QRIS POPUP */
    .qOverlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.60);
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index:130;
    }
    .qOverlay.show{display:flex}
    .qModal{
      width:min(520px, 100%);
      background:rgba(10,14,28,.94);
      border:1px solid rgba(255,255,255,.12);
      border-radius:24px;
      overflow:hidden;
      box-shadow:0 30px 100px rgba(0,0,0,.65);
    }
    .qHead{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .qHead b{font-size:14px}
    .qBody{padding:14px}
    .qImg{
      width:100%;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      background:rgba(255,255,255,.04);
    }
    .qImg img{width:100%; height:auto; display:block}
    .qSum{
      margin-top:10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
      font-weight:1000;
      display:flex; justify-content:space-between; gap:10px;
    }
  </style>
</head>

<body>
  <div class="bgshift"></div>

  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo">K</div>
        <div class="brandtxt">
          <b>KivoPay</b>
          <span>Aplikasi Premium ‚Ä¢ Order via WhatsApp</span>
        </div>
      </div>

      <div class="right">
        <div class="pill offline" id="adminPill">
          <span class="dot"></span>
          <span id="adminText"><b>Admin Offline</b></span>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="typing">
      <div class="text" id="typingText"></div>
      <div class="cursor"></div>
    </div>

    <div class="searchRow">
      <input id="search" class="search" placeholder='Cari produk... (contoh: Netflix, Canva, Capcut)' />
      <button class="btn ghost" id="resetBtn">Reset</button>
    </div>

    <div class="catCard">
      <div class="left">
        <h2>Kategori: Aplikasi Premium</h2>
        <p>Klik <b>Pesan</b> untuk pilih paket & checkout</p>
      </div>
      <div class="count"><span id="countTxt">0</span> produk</div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="note">
      <b>Kalo Mau Tambahan Produk Silahkan Chat Admin Ya Biar Admin Tambahin Produk Yang Kalian Mau</b>
    </div>
    <div class="waTab">
      <a class="btn" href="https://wa.me/6285150895395" target="_blank" rel="noopener">Chat WhatsApp Admin</a>
      <button class="btn ghost" id="copyAdmin">Salin Nomor Admin</button>
    </div>
  </div>

  <!-- CHECKOUT MODAL -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="mHead">
        <b>Checkout</b>
        <button class="x" id="closeModal">√ó</button>
      </div>

      <div class="mBody">
        <div class="field">
          <label>Produk</label>
          <div class="input" id="mProduk" style="display:flex;justify-content:space-between;gap:10px">
            <span id="mProdukName" style="font-weight:1000"></span>
            <span id="mProdukPrice" style="font-weight:1000;color:rgba(110,168,254,.95)"></span>
          </div>
        </div>

        <div class="field">
          <label>Pilih Durasi / Device</label>
          <select class="select" id="variantSelect"></select>
        </div>

        <div class="field">
          <label>Data Pembeli (wajib sebelum bayar)</label>
          <input class="input" id="nama" placeholder="Nama (wajib)" />
          <input class="input" id="email" placeholder="Email Buyer (wajib)" />
          <input class="input" id="wa" placeholder="Nomor WhatsApp (wajib) contoh: 628xxxxxxxxxxx" />
          <input class="input" id="lokasi" placeholder="Lokasi (opsional, contoh: Indonesia)" />
        </div>

        <div class="field">
          <label>Pilih Pembayaran</label>
          <div class="payRow">
            <button class="payBtn" data-pay="dana" id="payDana">
              <img alt="Dana" src="https://images.bukaolshop.com/hosting/181218/f2f4904ff62a785161.png" />
              <div style="min-width:0">
                Dana
                <small>087753513090</small>
              </div>
            </button>

            <button class="payBtn" data-pay="seabank" id="paySeabank">
              <img alt="Seabank" src="https://images.bukaolshop.com/hosting/181218/0d46bd2ba133491753.png" />
              <div style="min-width:0">
                SeaBank
                <small>901517870612</small>
              </div>
            </button>

            <button class="payBtn" data-pay="qris" id="payQris">
              <img alt="QRIS" src="https://images.bukaolshop.com/hosting/181218/111e83c3a6f5204498.png" />
              <div style="min-width:0">
                QRIS
                <small>Klik untuk scan</small>
              </div>
            </button>
          </div>

          <div class="qrisBox" id="qrisBox" style="display:none">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
              <div style="font-weight:1000">Metode: Tampilkan QRIS üëÅÔ∏è</div>
              <img alt="QRIS" src="https://images.bukaolshop.com/hosting/181218/111e83c3a6f5204498.png" style="width:28px;height:28px;border-radius:10px">
            </div>
            <button class="qrisShow" id="showQris">Tampilkan QRIS üëÅÔ∏è</button>
            <div class="helpSmall">Silakan scan QRIS, lalu centang "Saya sudah bayar".</div>
          </div>
        </div>

        <div class="chk">
          <input type="checkbox" id="paidChk" />
          <div>
            <b>Saya sudah bayar <span style="font-weight:800;color:var(--muted)">(wajib centang untuk aktifkan tombol kirim)</span></b>
            <span>Setelah bayar, tombol "Kirim ke WhatsApp Admin" akan aktif.</span>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="copyFormat">Salin Format</button>
          <a class="btn" id="sendWA" href="javascript:void(0)" style="pointer-events:none; opacity:.55;">Kirim ke WhatsApp Admin</a>
        </div>

        <div class="helpSmall" id="warnText">
          Lengkapi dulu: Nama, Email, Nomor WhatsApp. Pilih metode pembayaran. Lalu centang "Saya sudah bayar".
        </div>

        <div class="helpSmall" style="margin-top:10px">
          Admin WhatsApp: <b>6285150895395</b>
        </div>
      </div>
    </div>
  </div>

  <!-- QRIS POPUP -->
  <div class="qOverlay" id="qOverlay">
    <div class="qModal">
      <div class="qHead">
        <b>SHOW QRIS</b>
        <button class="x" id="closeQris">√ó</button>
      </div>
      <div class="qBody">
        <div style="text-align:center;color:var(--muted);font-weight:900;margin-bottom:10px">SCAN QRIS BERIKUT</div>
        <div class="qImg">
          <img src="https://images.bukaolshop.com/hosting/181218/cce817858ef1663896.png" alt="QRIS" />
        </div>
        <div class="qSum">
          <span>Jumlah bayar:</span>
          <span id="qAmount">Rp 0</span>
        </div>
      </div>
    </div>
  </div>

<script>
/* =======================
   DATA PRODUK
======================= */
const products = [
  { name:"Alight Motion Premium", img:"https://images.bukaolshop.com/hosting/181218/4a04b8d7e542788237.png",
    variants:[{label:"Private Akun 1 Tahun", price:9600}] },

  { name:"Prime Video", img:"https://images.bukaolshop.com/hosting/181218/ad8345f7b9c8953792.png",
    variants:[{label:"Shared 1 Bulan", price:6700},{label:"Private 1 Bulan", price:15300}] },

  { name:"Bstation Premium", img:"https://images.bukaolshop.com/hosting/181218/8a64287f1e0d26389.png",
    variants:[{label:"Akun Shared 3 Bulan", price:13300},{label:"Akun Private 1 Bulan", price:25300},{label:"Akun Private 2 Bulan", price:40300}] },

  { name:"Canva Pro Premium", img:"https://images.bukaolshop.com/hosting/181218/fc56c689cb9f975773.png",
    variants:[
      {label:"Member 7 Hari", price:100},
      {label:"Member 1 Bulan", price:700},
      {label:"Member 3 Bulan", price:2500},
      {label:"Edu Lifetime (Gar 6b)", price:10300},
    ] },

  { name:"Capcut Pro Premium", img:"https://images.bukaolshop.com/hosting/181218/47f862f5ed4a892435.png",
    variants:[
      {label:"Sharing 7 Day", price:8300},
      {label:"Sharing 1 Bulan", price:10300},
      {label:'Sharing 1 Tahun (Renew)', price:25000},
      {label:"Private 7 Day", price:12000},
      {label:'Private 1 Bulan (Renew)', price:17000},
    ] },

  { name:"ChatGpt Premium", img:"https://images.bukaolshop.com/hosting/181218/26f804d66e6e88158.png",
    variants:[
      {label:"Member Plan 1 Bulan Private", price:25700},
      {label:"Owner Business Plan 1 Bulan", price:84300},
      {label:"Plus Plan 1 Bulan Private", price:20300},
      {label:"Plus Plan 1 Bulan Private (Varian 2)", price:30500},
    ] },

  { name:"IQIYI Premium", img:"https://images.bukaolshop.com/hosting/181218/891f9cc79330873789.png",
    variants:[
      {label:"Iqiyi Premium 1 Bulan Shared", price:15300},
      {label:"Iqiyi Premium 1 Bulan Shared 2 Devices", price:23500},
    ] },

{ name:"Vidio Premium", img:"https://images.bukaolshop.com/hosting/181218/1174d76c8ed6103972.png",
    variants:[
      {label:"Shared 1 Bulan 2 User Mobile", price:18800},
      {label:"Private 1 Bulan Khusus Mobile", price:32400},
    ] },

  { name:"Vision+ Premium", img:"https://images.bukaolshop.com/hosting/181218/072f4a242c47628279.png",
    variants:[{label:"Private Akun 1 Bulan All Screen", price:30000}] },

  { name:"Viu Premium", img:"https://images.bukaolshop.com/hosting/181218/e185c3b3935534665.png",
    variants:[{label:"Private 3 Bulan 1 Device", price:7000},{label:"Private 6 Bulan 1 Device", price:8600}] },

  { name:"Wetv Premium", img:"https://images.bukaolshop.com/hosting/181218/9639c4484b80226918.png",
    variants:[{label:"Wetv Premium 1 Bulan Shared", price:13600},{label:"Wetv Premium 1 Bulan Private", price:35300}] },

  { name:"YouTube Premium", img:"https://images.bukaolshop.com/hosting/181218/e1b9eae8982d985428.png",
    variants:[{label:"Famplan 1 Bulan", price:6000},{label:"Indplan Norush 1 Bulan", price:13000}] },

  { name:"Lok Lok Premium", img:"https://images.bukaolshop.com/hosting/181218/281994f16dd4975145.png",
    variants:[
      {label:"Sharing 1 Bulan 3 User", price:20300},
      {label:"Sharing 1 Bulan 5 User", price:25300},
      {label:"Private 1 Bulan Basic", price:55300},
      {label:"Private 1 Bulan Standar", price:80000},
    ] },

  { name:"Wink Premium", img:"https://images.bukaolshop.com/hosting/181218/1bcea869e27c407235.png",
    variants:[{label:"Private 7 Day acc b", price:8300},{label:"Private 7 Day acc s", price:12300}] },

  { name:"Netflix Premium", img:"https://images.bukaolshop.com/hosting/181218/e97361a0f1be36831.png",
    variants:[
      {label:"Sharing 1p1u 7 Day", price:18000},
      {label:"Sharing 1p1u 1 Bulan", price:31000},
      {label:"Sharing 1p2u 7 Day", price:17000},
      {label:"Sharing 1p2u 1 Bulan", price:27000},
      {label:"Private Akun 1 Bulan", price:200000},
    ] },

  { name:"Gemini Premium", img:"https://images.bukaolshop.com/hosting/181218/4a193950e401725286.png",
    variants:[{label:"Private 1 Bulan", price:10300},{label:"Private 1 Tahun", price:18300}] },

  { name:"HBO Max Premium", img:"https://images.bukaolshop.com/hosting/181218/4f504ab6ac35117507.png",
    variants:[
      {label:"Sharing 1 Bulan Standar", price:18300},
      {label:"Sharing 1 Bulan Ultimate", price:22000},
      {label:"Private 1 Bulan Standar", price:55300},
      {label:"Private 1 Bulan Ultimate", price:65300},
    ] },
];

/* =======================
   HELPERS
======================= */
const rupiah = (n)=>{
  // keep exactly like your style: Rp 9.600
  const s = Math.round(n).toString();
  const parts = [];
  for(let i=s.length;i>0;i-=3){
    parts.unshift(s.substring(Math.max(0,i-3), i));
  }
  return "Rp " + parts.join(".");
};
const minPrice = (p)=> Math.min(...p.variants.map(v=>v.price));

/* =======================
   RENDER GRID
======================= */
const grid = document.getElementById("grid");
const countTxt = document.getElementById("countTxt");

function render(list){
  grid.innerHTML = "";
  countTxt.textContent = list.length;

  list.forEach((p, idx)=>{
    const c = document.createElement("div");
    c.className="card";
    c.innerHTML = `
      <div class="imgWrap"><img src="${p.img}" alt="${p.name}"></div>
      <div class="body">
        <p class="name">${p.name}</p>
        <p class="desc">Klik Pesan untuk pilih paket & checkout</p>
        <div class="row">
          <div class="price">Mulai ${rupiah(minPrice(p))}</div>
          <button class="mini" data-idx="${idx}">Pesan</button>
        </div>
      </div>
    `;
    grid.appendChild(c);
  });

  // bind buttons
  grid.querySelectorAll(".mini").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const name = btn.closest(".card").querySelector(".name").textContent;
      const p = products.find(x=>x.name===name);
      openCheckout(p);
    });
  });
}

/* =======================
   SEARCH
======================= */
const search = document.getElementById("search");
document.getElementById("resetBtn").addEventListener("click", ()=>{
  search.value="";
  render(products);
});
search.addEventListener("input", ()=>{
  const q = search.value.trim().toLowerCase();
  if(!q){ render(products); return; }
  const filtered = products.filter(p=>p.name.toLowerCase().includes(q));
  render(filtered);
});

/* =======================
   ADMIN STATUS (2 sesi)
   Siang 10:30-13:00
   Malam 16:30-22:30
======================= */
function inRange(min, h1,m1, h2,m2){
  return min >= (h1*60+m1) && min < (h2*60+m2);
}
function updateAdminStatus(){
  const now = new Date();
  const min = now.getHours()*60 + now.getMinutes();

  const siang = inRange(min,10,30,13,0);
  const malam = inRange(min,16,30,22,30);
  const online = siang || malam;

  const pill = document.getElementById("adminPill");
  const txt = document.getElementById("adminText");

  pill.classList.remove("online","offline");
  pill.classList.add(online ? "online" : "offline");
  txt.innerHTML = online ? "<b>Admin Online</b>" : "<b>Admin Offline</b>";
}
updateAdminStatus();
setInterval(updateAdminStatus, 20000);

/* =======================
   TYPING LOOP
======================= */
const typingText = document.getElementById("typingText");
const typingMsg = "Harap Jangan Order Ketika Status Admin Offline Nekat Order Kami Proses Besok Nya üôè";
let ti=0, deleting=false;

function tick(){
  if(!deleting){
    ti++;
    typingText.textContent = typingMsg.slice(0, ti);
    if(ti >= typingMsg.length){
      deleting=true;
      setTimeout(tick, 900);
      return;
    }
  }else{
    ti--;
    typingText.textContent = typingMsg.slice(0, ti);
    if(ti <= 0){
      deleting=false;
      setTimeout(tick, 350);
      return;
    }
  }
  setTimeout(tick, deleting ? 18 : 22);
}
tick();

/* =======================
   CHECKOUT MODAL
======================= */
const overlay = document.getElementById("overlay");
const closeModal = document.getElementById("closeModal");

const mProdukName = document.getElementById("mProdukName");
const mProdukPrice = document.getElementById("mProdukPrice");
const variantSelect = document.getElementById("variantSelect");

const nama = document.getElementById("nama");
const email = document.getElementById("email");
const wa = document.getElementById("wa");
const lokasi = document.getElementById("lokasi");

const payDana = document.getElementById("payDana");
const paySeabank = document.getElementById("paySeabank");
const payQris = document.getElementById("payQris");
const qrisBox = document.getElementById("qrisBox");
const showQris = document.getElementById("showQris");

const paidChk = document.getElementById("paidChk");
const copyFormat = document.getElementById("copyFormat");
const sendWA = document.getElementById("sendWA");
const warnText = document.getElementById("warnText");

const qOverlay = document.getElementById("qOverlay");
const closeQris = document.getElementById("closeQris");
const qAmount = document.getElementById("qAmount");

let currentProduct = null;
let currentPay = null; // dana | seabank | qris

function openCheckout(p){
  currentProduct = p;
  currentPay = null;
  paidChk.checked = false;

  // reset styles
  [payDana,paySeabank,payQris].forEach(b=>b.classList.remove("active"));
  qrisBox.style.display="none";

  mProdukName.textContent = p.name;

  variantSelect.innerHTML = "";
  p.variants.forEach((v,i)=>{
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = `${v.label} ‚Ä¢ ${rupiah(v.price)}`;
    variantSelect.appendChild(opt);
  });

  // default first
  updateSelectedVariant();

  // open
  overlay.classList.add("show");
  document.body.style.overflow="hidden";
  validateAll();
}

function closeCheckout(){
  overlay.classList.remove("show");
  document.body.style.overflow="";
}

closeModal.addEventListener("click", closeCheckout);
overlay.addEventListener("click", (e)=>{
  if(e.target === overlay) closeCheckout();
});

variantSelect.addEventListener("change", ()=>{
  updateSelectedVariant();
  validateAll();
});

function updateSelectedVariant(){
  const idx = Number(variantSelect.value || 0);
  const v = currentProduct.variants[idx];
  mProdukPrice.textContent = rupiah(v.price);
  qAmount.textContent = rupiah(v.price);
}

/* payment buttons */
function setPay(type){
  currentPay = type;
  [payDana,paySeabank,payQris].forEach(b=>b.classList.remove("active"));
  if(type==="dana") payDana.classList.add("active");
  if(type==="seabank") paySeabank.classList.add("active");
  if(type==="qris") {
    payQris.classList.add("active");
    qrisBox.style.display="block";
  } else {
    qrisBox.style.display="none";
  }
  validateAll();
}
payDana.addEventListener("click", ()=>setPay("dana"));
paySeabank.addEventListener("click", ()=>setPay("seabank"));
payQris.addEventListener("click", ()=>setPay("qris"));

/* QRIS popup */
showQris.addEventListener("click", ()=>{
  // open qris popup
  qOverlay.classList.add("show");
});
closeQris.addEventListener("click", ()=> qOverlay.classList.remove("show"));
qOverlay.addEventListener("click", (e)=>{
  if(e.target === qOverlay) qOverlay.classList.remove("show");
});

/* =======================
   ORDER FORMAT + WHATSAPP
======================= */
function buildOrderText(){
  const v = currentProduct.variants[Number(variantSelect.value || 0)];
  const payLabel = currentPay === "dana" ? "Dana" : currentPay === "seabank" ? "SeaBank" : currentPay === "qris" ? "QRIS" : "-";

  const msg =
`Format Orderan KivoPay ‚ú®
Nama : ${nama.value.trim()}
Produk : ${currentProduct.name}
Email Buyer : ${email.value.trim()}
Durasi & Device Buyer : ${v.label}
Lokasi : ${lokasi.value.trim() || "-"}

Metode Pembayaran : ${payLabel}
Total : ${rupiah(v.price)}

Tolong Di Proses Secepatnya Ya Kak üôè`;
  return msg;
}

function validateAll(){
  const okNama = nama.value.trim().length >= 2;
  const okEmail = email.value.trim().includes("@") && email.value.trim().includes(".");
  const okWa = wa.value.trim().length >= 9; // minimal
  const okPay = !!currentPay;
  const okPaid = paidChk.checked === true;

  let msg = "Lengkapi dulu: Nama, Email, Nomor WhatsApp. Pilih metode pembayaran. Lalu centang \"Saya sudah bayar\".";
  if(!okPay) msg = "Pilih dulu metode pembayaran (Dana / SeaBank / QRIS).";
  if(okPay && (!okNama || !okEmail || !okWa)) msg = "Lengkapi dulu: Nama, Email, Nomor WhatsApp.";
  if(okPay && okNama && okEmail && okWa && !okPaid) msg = "Kalau sudah bayar, centang dulu \"Saya sudah bayar\" biar tombol kirim aktif.";

  warnText.textContent = msg;

  const canSend = okNama && okEmail && okWa && okPay && okPaid;
  sendWA.style.pointerEvents = canSend ? "auto" : "none";
  sendWA.style.opacity = canSend ? "1" : ".55";

  if(canSend){
    const phone = "6285150895395";
    const text = encodeURIComponent(buildOrderText());
    sendWA.href = `https://wa.me/${phone}?text=${text}`;
  }else{
    sendWA.href = "javascript:void(0)";
  }
}

[nama,email,wa,lokasi].forEach(el=> el.addEventListener("input", validateAll));
paidChk.addEventListener("change", validateAll);

/* copy format */
copyFormat.addEventListener("click", async ()=>{
  try{
    await navigator.clipboard.writeText(buildOrderText());
    warnText.textContent = "Format berhasil disalin ‚úÖ";
  }catch(e){
    warnText.textContent = "Gagal salin (browser kamu blok). Coba tekan & tahan teks manual.";
  }
});

/* copy admin number */
document.getElementById("copyAdmin").addEventListener("click", async ()=>{
  try{
    await navigator.clipboard.writeText("6285150895395");
    alert("Nomor admin disalin: 6285150895395");
  }catch(e){
    alert("Gagal salin. Nomor admin: 6285150895395");
  }
});

/* close modal with ESC */
document.addEventListener("keydown", (e)=>{
  if(e.key==="Escape"){
    if(qOverlay.classList.contains("show")) qOverlay.classList.remove("show");
    if(overlay.classList.contains("show")) closeCheckout();
  }
});

/* initial render */
render(products);
</script>
</body>
</html>
