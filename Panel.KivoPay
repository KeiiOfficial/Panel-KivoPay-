<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KivoPay</title>

  <style>
    :root{
      --bg:#070a12;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:#aeb9d6;
      --accent:#6ea8fe;
      --ok:#41d18f;
      --warn:#ffcc66;
      --bad:#ff5f6d;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 420px at 10% 10%, rgba(110,168,254,.18), transparent 55%),
        radial-gradient(800px 420px at 90% 20%, rgba(124,255,178,.10), transparent 55%),
        linear-gradient(180deg,#070a12,#0b1020);
    }
    a{color:inherit}
    .app{max-width:1080px;margin:0 auto;padding:14px 12px 28px}
    .topbar{
      position:sticky;top:0;z-index:50;
      display:flex;align-items:center;gap:10px;
      padding:10px 10px;
      background:rgba(7,10,18,.65);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .brand{
      display:flex;align-items:center;gap:10px;min-width:180px;
    }
    .avatar{
      width:42px;height:42px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .avatar img{width:100%;height:100%;object-fit:cover}
    .brand h1{font-size:16px;margin:0;font-weight:850;letter-spacing:.2px}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted)}
    .grow{flex:1}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{width:9px;height:9px;border-radius:999px;background:var(--warn);box-shadow:0 0 0 4px rgba(255,204,102,.12)}
    .dot.ok{background:var(--ok);box-shadow:0 0 0 4px rgba(65,209,143,.12)}
    .btn{
      appearance:none;border:none;cursor:pointer;
      padding:10px 12px;border-radius:14px;
      background:rgba(110,168,254,.14);
      border:1px solid rgba(110,168,254,.28);
      color:#d7e6ff;
      font-weight:750;
      display:inline-flex;align-items:center;gap:8px;
      transition:transform .08s ease, filter .15s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      font-weight:700;
    }
    .btn.danger{
      background:rgba(255,95,109,.10);
      border:1px solid rgba(255,95,109,.25);
      color:#ffd7db;
    }
    .btn.full{width:100%;justify-content:center}
    .grid{
      display:grid;gap:12px;
    }
    .hero{
      margin-top:10px;
      padding:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
      border-radius:var(--r);
      box-shadow: var(--shadow);
    }
    .heroTop{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
    }
    .typing{
      font-weight:900;
      line-height:1.2;
      font-size:15px;
      margin:0;
    }
    .typing small{display:block;margin-top:6px;color:var(--muted);font-weight:650;font-size:12.5px}
    .searchRow{
      margin-top:12px;
      display:flex;gap:10px;
    }
    .inp{
      width:100%;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:11px 12px;
      color:var(--text);
      outline:none;
    }
    .inp::placeholder{color:rgba(174,185,214,.7)}
    .section{
      margin-top:12px;
      padding:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      border-radius:var(--r);
      box-shadow: var(--shadow);
    }
    .secTitle{
      display:flex;align-items:baseline;justify-content:space-between;gap:10px;
      margin:0 0 10px;
    }
    .secTitle h2{margin:0;font-size:16px;font-weight:900}
    .secTitle span{color:var(--muted);font-size:12.5px}
    .cards{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;
    }
    @media (min-width:900px){
      .cards{grid-template-columns: repeat(4, minmax(0, 1fr));}
    }
    .card{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      border-radius:18px;
      overflow:hidden;
      display:flex;flex-direction:column;
      min-height:210px;
    }
    .thumb{
      background:#fff;
      padding:10px;
      display:flex;align-items:center;justify-content:center;
      height:120px;
    }
    .thumb img{max-width:100%;max-height:100%;border-radius:12px}
    .cardBody{padding:10px 10px 12px;display:flex;flex-direction:column;gap:8px;flex:1}
    .cardBody h3{margin:0;font-size:13.5px;font-weight:900}
    .cardBody p{margin:0;color:var(--muted);font-size:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:auto}
    .price{font-weight:900;color:#cfe2ff}
    .mini{font-size:11.5px;color:rgba(174,185,214,.85)}
    .tag{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 9px;border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      font-size:11.5px;
    }

    /* modal */
    .overlay{
      position:fixed;inset:0;z-index:999;
      display:none;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      padding:14px;
    }
    .overlay.show{display:flex;align-items:flex-end;justify-content:center}
    @media(min-width:700px){
      .overlay.show{align-items:center}
    }
    .modal{
      width:min(560px, 100%);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(8,12,22,.92);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(12px);
      animation: pop .18s ease forwards;
    }
    @keyframes pop {to{transform: translateY(0)}}
    .modalHd{
      padding:12px 12px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .modalHd strong{font-weight:950}
    .x{cursor:pointer;padding:10px 12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10)}
    .modalBody{padding:12px}
    .split{display:grid;gap:12px}
    @media(min-width:700px){.split{grid-template-columns: 180px 1fr;align-items:start}}
    .pimg{background:#fff;border-radius:18px;padding:12px;border:1px solid rgba(255,255,255,.10)}
    .pimg img{width:100%;height:auto;border-radius:14px}
    .list{display:flex;flex-direction:column;gap:10px}
    .opt{
      padding:10px 10px;border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      cursor:pointer;
    }
    .opt:hover{filter:brightness(1.06)}
    .opt b{font-weight:900}
    .opt span{color:var(--muted);font-size:12.5px}
    .opt .rp{font-weight:950;color:#cfe2ff}

    /* pages */
    .page{display:none}
    .page.show{display:block}

    /* form */
    .form{display:grid;gap:10px;margin-top:10px}
    .label{font-size:12px;color:var(--muted);font-weight:700}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    .payGrid{display:grid;gap:12px}
    @media(min-width:900px){.payGrid{grid-template-columns:1.2fr .8fr}}
    .box{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      border-radius:18px;
      padding:12px;
    }
    .box h3{margin:0 0 8px;font-size:14.5px;font-weight:950}
    .kv{display:flex;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,.10)}
    .kv:last-child{border-bottom:none}
    .kv .k{color:var(--muted);font-weight:700;font-size:12.5px}
    .kv .v{font-weight:900;font-size:12.8px;text-align:right}
    .methods{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .mBtn{
      padding:9px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;font-weight:800;font-size:12.5px;
      display:flex;gap:8px;align-items:center;
    }
    .mBtn.active{
      border-color: rgba(110,168,254,.35);
      background: rgba(110,168,254,.14);
      color:#d7e6ff;
    }
    .payMethod{display:none;margin-top:10px}
    .payMethod.show{display:block}
    .copyRow{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .smallImg{width:28px;height:28px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,.12);background:#fff}
    .smallImg img{width:100%;height:100%;object-fit:cover}
    .qrisWrap{text-align:center}
    .qrisWrap img{
      width:min(320px, 100%);
      background:#fff;
      padding:10px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      display:none;
    }
    .qrisWrap img.show{display:inline-block}
    .toast{
      position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
      background:rgba(0,0,0,.72);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      font-weight:750;font-size:12.5px;
      display:none;z-index:9999;
      max-width:min(520px, 92vw);
      box-shadow: var(--shadow);
    }
    .toast.show{display:block}
    .muteline{height:1px;background:rgba(255,255,255,.08);margin:10px 0}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand" onclick="go('#/home')" style="cursor:pointer">
      <div class="avatar"><img id="brandLogo" alt="K" /></div>
      <div>
        <h1 id="brandName">KivoPay</h1>
        <p id="brandSub">Aplikasi Premium ‚Ä¢ Order via WhatsApp</p>
      </div>
    </div>
    <div class="grow"></div>

    <div class="chip" id="adminChip" title="Status Admin otomatis WIB">
      <span class="dot" id="adminDot"></span>
      <span id="adminText">Checking‚Ä¶</span>
    </div>

    <button class="btn secondary" id="btnLogout" style="display:none" onclick="logout()">Keluar</button>
    <button class="btn" id="btnLoginTop" style="display:none" onclick="go('#/login')">Login</button>
  </div>

  <div class="app">
    <!-- LOGIN PAGE -->
    <div class="page" id="page-login">
      <div class="hero">
        <div class="heroTop">
          <div>
            <p class="typing">
              <span id="typingText"></span><span id="typingCursor">‚ñç</span>
              <small>Login dulu ya, biar order kamu rapi.</small>
            </p>
          </div>
          <span class="tag">üîí Login</span>
        </div>

        <div class="form">
          <div>
            <div class="label">Nama</div>
            <input class="inp" id="inName" placeholder="Nama kamu" />
          </div>
          <div>
            <div class="label">Nomor WhatsApp</div>
            <input class="inp" id="inWa" inputmode="numeric" placeholder="contoh: 0851xxxxxxx" />
          </div>
          <div>
            <div class="label">Password</div>
            <input class="inp" id="inPass" type="password" placeholder="Buat password" />
          </div>
          <button class="btn full" onclick="doLogin()">Masuk</button>
          <button class="btn secondary full" onclick="go('#/home')">Lihat Produk (tanpa login)</button>
        </div>
      </div>
    </div>

    <!-- HOME PAGE -->
    <div class="page" id="page-home">
      <div class="hero">
        <div class="heroTop">
          <div>
            <p class="typing">
              <span id="typingTextHome"></span><span id="typingCursorHome">‚ñç</span>
              <small>Klik <b>Pesan</b> untuk pilih paket & checkout.</small>
            </p>
          </div>
          <span class="tag" id="userTag">üîì Belum login</span>
        </div>

        <div class="searchRow">
          <input class="inp" id="search" placeholder="Cari produk... (contoh: Netflix, Canva, Capcut)" oninput="renderProducts()" />
          <button class="btn" onclick="go('#/login')" id="btnLoginHero">Login</button>
        </div>
      </div>

      <div class="section">
        <div class="secTitle">
          <h2>Kategori: Aplikasi Premium</h2>
          <span id="countText">0 produk</span>
        </div>
        <div class="cards" id="productList"></div>
      </div>
    </div>

    <!-- CHECKOUT/PAY PAGE -->
    <div class="page" id="page-pay">
      <div class="section">
        <div class="secTitle">
          <h2>Checkout & Pembayaran</h2>
          <span class="mini" id="trxMini">-</span>
        </div>

        <div class="payGrid">
          <div class="box">
            <h3>üßæ Detail Order</h3>
            <div class="kv"><div class="k">Nama</div><div class="v" id="dName">-</div></div>
            <div class="kv"><div class="k">WhatsApp</div><div class="v" id="dWa">-</div></div>
            <div class="kv"><div class="k">Produk</div><div class="v" id="dProd">-</div></div>
            <div class="kv"><div class="k">Paket</div><div class="v" id="dPack">-</div></div>
            <div class="kv"><div class="k">Harga</div><div class="v" id="dPrice">-</div></div>

            <div class="muteline"></div>

            <div class="label">Email Buyer</div>
            <input class="inp" id="inEmail" placeholder="contoh: email@gmail.com" />

            <div class="two">
              <div>
                <div class="label">Durasi & Device Buyer</div>
                <input class="inp" id="inDur" placeholder="misal: 1 Bulan / 2 Device" />
              </div>
              <div>
                <div class="label">Lokasi</div>
                <input class="inp" id="inLoc" placeholder="misal: Indonesia" />
              </div>
            </div>

            <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
              <button class="btn" onclick="sendToAdmin()">Kirim ke Admin (WA)</button>
              <button class="btn secondary" onclick="checkPaymentStatus()">Cek Status Pembayaran</button>
              <button class="btn secondary" onclick="go('#/home')">Kembali</button>
            </div>

            <div style="margin-top:10px" class="mini" id="statusBox">
              Status: <b id="payStatus" style="color:var(--warn)">PENDING</b>
              <span id="statusHint" class="mini">‚Ä¢ (Tanpa server, ini demo. Kalau pakai callback gateway, status bisa otomatis.)</span>
            </div>
          </div>

          <div class="box">
            <h3>üí≥ Metode Pembayaran (KivoPay)</h3>

            <div class="methods">
              <div class="mBtn active" onclick="selectMethod('dana')" id="m-dana">
                <span class="smallImg"><img src="https://images.bukaolshop.com/hosting/181218/f2f4904ff62a785161.png" alt="Dana"></span>
                Dana
              </div>
              <div class="mBtn" onclick="selectMethod('seabank')" id="m-seabank">
                <span class="smallImg"><img src="https://images.bukaolshop.com/hosting/181218/0d46bd2ba133491753.png" alt="SeaBank"></span>
                SeaBank
              </div>
              <div class="mBtn" onclick="selectMethod('qris')" id="m-qris">
                <span class="smallImg"><img src="https://images.bukaolshop.com/hosting/181218/111e83c3a6f5204498.png" alt="QRIS"></span>
                QRIS
              </div>
            </div>

            <!-- DANA -->
            <div class="payMethod show" id="pm-dana">
              <div class="copyRow" style="margin-top:10px">
                <div>
                  <div class="mini">Nomor Dana</div>
                  <div style="font-weight:950;font-size:15px" id="danaNum">087753513090</div>
                </div>
                <button class="btn secondary" onclick="copyText('087753513090')">Copy</button>
              </div>
              <div class="mini" style="margin-top:8px;color:rgba(174,185,214,.85)">
                Transfer sesuai nominal ‚Üí lalu klik <b>Kirim ke Admin (WA)</b>.
              </div>
            </div>

            <!-- SEABANK -->
            <div class="payMethod" id="pm-seabank">
              <div class="copyRow" style="margin-top:10px">
                <div>
                  <div class="mini">Rekening SeaBank</div>
                  <div style="font-weight:950;font-size:15px" id="seaNum">901517870612</div>
                </div>
                <button class="btn secondary" onclick="copyText('901517870612')">Copy</button>
              </div>
              <div class="mini" style="margin-top:8px;color:rgba(174,185,214,.85)">
                Transfer sesuai nominal ‚Üí lalu klik <b>Kirim ke Admin (WA)</b>.
              </div>
            </div>

            <!-- QRIS -->
            <div class="payMethod" id="pm-qris">
              <div class="qrisWrap" style="margin-top:10px">
                <div class="mini">Scan QRIS</div>
                <button class="btn secondary" style="margin:10px auto 0" onclick="toggleQris()">
                  üëÅÔ∏è Tampilkan QRIS
                </button>
                <div style="margin-top:12px">
                  <img id="qrisImg" src="https://images.bukaolshop.com/hosting/181218/cce817858ef1663896.png" alt="QRIS">
                </div>
                <div class="mini" style="margin-top:10px;color:rgba(174,185,214,.85)">
                  Kalau QR belum muncul, coba refresh 1x.
                </div>
              </div>
            </div>

            <div class="muteline"></div>

            <div class="mini" style="color:rgba(174,185,214,.85)">
              <b>Catatan:</b> ‚ÄúCek Status Pembayaran‚Äù butuh sistem gateway + callback server biar benar-benar otomatis.
              Template ini sudah siap, tinggal sambungkan API kamu nanti.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PRODUCT MODAL -->
    <div class="overlay" id="overlay" onclick="closeModal(event)">
      <div class="modal" role="dialog" aria-modal="true">
        <div class="modalHd">
          <strong id="mTitle">Produk</strong>
          <div class="x" onclick="closeModal()">‚úï</div>
        </div>
        <div class="modalBody">
          <div class="split">
            <div class="pimg"><img id="mImg" alt="produk"></div>
            <div class="list" id="mList"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ================= CONFIG =================
    const CONFIG = {
      appName: "KivoPay",
      appSubtitle: "Aplikasi Premium ‚Ä¢ Order via WhatsApp",
      adminWaLink: "https://wa.me/6285150895395",
      typingText: "Halo Selamat Datang Di Website KivoPay, Semogaa Layanan Kami Memuaskan ‚ò∫Ô∏èüôè",
      timezone: "Asia/Jakarta", // WIB
      adminOnlineStart: "16:30", // WIB
      adminOnlineEnd: "22:30",   // WIB
      // Kalau kamu punya API untuk cek status, isi di sini (opsional):
      // contoh: "https://domainkamu.com/api/status?id="
      STATUS_ENDPOINT: "" // kosong = demo
    };
// ================ DATA PRODUK ================
    const products = [
      {
        name:"Alight Motion Premium",
        img:"https://images.bukaolshop.com/hosting/181218/4a04b8d7e542788237.png",
        variants:[{label:"Private Akun 1 Tahun", price:9600}]
      },
      {
        name:"Prime Video",
        img:"https://images.bukaolshop.com/hosting/181218/ad8345f7b9c8953792.png",
        variants:[
          {label:"Shared 1 Bulan", price:6700},
          {label:"Private 1 Bulan", price:15300}
        ]
      },
      {
        name:"Bstation Premium",
        img:"https://images.bukaolshop.com/hosting/181218/8a64287f1e0d26389.png",
        variants:[
          {label:"Akun Shared 3 Bulan", price:13300},
          {label:"Akun Private 1 Bulan", price:25300},
          {label:"Akun Private 2 Bulan", price:40300}
        ]
      },
      {
        name:"Canva Pro Premium",
        img:"https://images.bukaolshop.com/hosting/181218/fc56c689cb9f975773.png",
        variants:[
          {label:"Member 7 Hari", price:100},
          {label:"Member 1 Bulan", price:700},
          {label:"Member 3 Bulan", price:2500},
          {label:"Edu Lifetime", price:10300}
        ]
      },
      {
        name:"Capcut Pro Premium",
        img:"https://images.bukaolshop.com/hosting/181218/47f862f5ed4a892435.png",
        variants:[
          {label:"Private Akun 1 Bulan Gar 7h", price:11300},
          {label:"Private Akun 1 Bulan Gar 28h", price:20300}
        ]
      },
      {
        name:"ChatGpt Premium",
        img:"https://images.bukaolshop.com/hosting/181218/26f804d66e6e88158.png",
        variants:[
          {label:"Member Plan 1 Bulan Private", price:25700},
          {label:"Owner Business Plan 1 Bulan", price:84300},
          {label:"Plus Plan 1 Bulan Private", price:20300},
          {label:"Plus Plan 1 Bulan Private (varian 2)", price:30500}
        ]
      },
      {
        name:"IQIYI Premium",
        img:"https://images.bukaolshop.com/hosting/181218/891f9cc79330873789.png",
        variants:[
          {label:"Iqiyi Premium 1 Bulan Shared", price:15300},
          {label:"Iqiyi Premium 1 Bulan Shared 2 Devices", price:23500}
        ]
      },
      {
        name:"Video Premium",
        img:"https://images.bukaolshop.com/hosting/181218/1174d76c8ed6103972.png",
        variants:[
          {label:"Shared 1 Bulan 2 User Mobile", price:18800},
          {label:"Private 1 Bulan Khusus Mobile", price:32400}
        ]
      },
      {
        name:"Vision+ Premium",
        img:"https://images.bukaolshop.com/hosting/181218/072f4a242c47628279.png",
        variants:[
          {label:"Private Akun 1 Bulan All Screen", price:30000}
        ]
      },
      {
        name:"Viu Premium",
        img:"https://images.bukaolshop.com/hosting/181218/e185c3b3935534665.png",
        variants:[
          {label:"Private 3 Bulan 1 Device", price:7000},
          {label:"Private 6 Bulan 1 Device", price:8600}
        ]
      },
      {
        name:"Wetv Premium",
        img:"https://images.bukaolshop.com/hosting/181218/9639c4484b80226918.png",
        variants:[
          {label:"Wetv Premium 1 Bulan Shared", price:13600},
          {label:"Wetv Premium 1 Bulan Private", price:35300}
        ]
      },
      {
        name:"YouTube Premium",
        img:"https://images.bukaolshop.com/hosting/181218/e1b9eae8982d985428.png",
        variants:[
          {label:"Anggota Family Plan 1 Bulan Invited", price:8300}
        ]
      },
      {
        name:"Lok Lok Premium",
        img:"https://images.bukaolshop.com/hosting/181218/281994f16dd4975145.png",
        variants:[
          {label:"Sharing 1 Bulan 3 User", price:20300},
          {label:"Sharing 1 Bulan 5 User", price:25300},
          {label:"Private 1 Bulan Basic", price:55300},
          {label:"Private 1 Bulan Standar", price:80000}
        ]
      },
      {
        name:"Wink Premium",
        img:"https://images.bukaolshop.com/hosting/181218/1bcea869e27c407235.png",
        variants:[
          {label:"Private 7 Day acc b", price:8300},
          {label:"Private 7 Day acc s", price:12300}
        ]
      },
      {
        name:"Netflix Premium",
        img:"https://images.bukaolshop.com/hosting/181218/e97361a0f1be36831.png",
        variants:[
          {label:"Sharing 1p1u 7 Day", price:18000},
          {label:"Sharing 1p1u 1 Bulan", price:31000},
          {label:"Sharing 1p2u 7 Day", price:17000},
          {label:"Sharing 1p2u 1 Bulan", price:27000},
          {label:"Private Akun 1 Bulan", price:200000}
        ]
      },
    ];

    // ================ STATE ================
    let currentProduct = null;
    let currentVariant = null;
    let currentMethod = "dana";
    let currentTrxId = "";

    // ================ UTIL ================
    const $ = (id)=>document.getElementById(id);
    const fmt = (n)=> "Rp " + (Number(n)||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
    const toast = (msg)=>{
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1800);
    };
    const go = (hash)=>{ location.hash = hash; };
    const getUser = ()=>{
      try { return JSON.parse(localStorage.getItem("kivopay_user")||"null"); } catch { return null; }
    };
    const setUser = (u)=> localStorage.setItem("kivopay_user", JSON.stringify(u));
    const clearUser = ()=> localStorage.removeItem("kivopay_user");

    // WIB time helpers
    function getWibNow(){
      // safe convert using Intl formatting (works on most browsers)
      const parts = new Intl.DateTimeFormat("en-GB", {
        timeZone: CONFIG.timezone,
        hour12:false,
        year:"numeric",month:"2-digit",day:"2-digit",
        hour:"2-digit",minute:"2-digit",second:"2-digit"
      }).formatToParts(new Date()).reduce((a,p)=> (a[p.type]=p.value, a), {});
      // build Date in local but with WIB components
      return {
        hh: Number(parts.hour),
        mm: Number(parts.minute),
        ss: Number(parts.second),
        dateStr: `${parts.year}-${parts.month}-${parts.day}`,
        timeStr: `${parts.hour}:${parts.minute}:${parts.second}`
      };
    }
    function timeToMin(t){ // "HH:MM"
      const [h,m]=t.split(":").map(Number);
      return h*60+m;
    }
    function isAdminOnline(){
      const now = getWibNow();
      const cur = now.hh*60 + now.mm;
      const start = timeToMin(CONFIG.adminOnlineStart);
      const end = timeToMin(CONFIG.adminOnlineEnd);
      return (cur >= start && cur < end);
    }

    // ================ ADMIN STATUS ================
    function renderAdminStatus(){
      const online = isAdminOnline();
      $("adminDot").className = "dot" + (online ? " ok" : "");
      $("adminText").textContent = online ? `Ready ‚Ä¢ Admin Online` : `Belum login ‚Ä¢ Admin Offline`;
      // admin chip text "Belum login" di screenshot kamu -> kita bikin sesuai status login juga:
      const u = getUser();
      if(online){
        $("adminText").textContent = "Ready ‚Ä¢ Admin Online";
      } else {
        $("adminText").textContent = u ? "Admin Offline" : "Belum login ‚Ä¢ Admin Offline";
      }
    }

    // ================ TYPING ANIMATION ================
    function startTyping(elText, elCursor){
      const text = CONFIG.typingText;
      let i=0, dir=1; // 1 typing, -1 deleting
      let pause=0;
      function tick(){
        if(pause>0){ pause--; return; }
        i += dir;
        if(i >= text.length){
          i = text.length;
          dir = -1;
          pause = 18; // pause before delete
        }
        if(i <= 0){
          i = 0;
          dir = 1;
          pause = 12; // pause before type
        }
        elText.textContent = text.slice(0,i);
      }
      setInterval(tick, 70);
      // cursor blink
      setInterval(()=>{ elCursor.style.opacity = (elCursor.style.opacity==="0" ? "1" : "0"); }, 520);
    }

    // ================ ROUTER ================
    function showPage(name){
      const pages = ["login","home","pay"];
      pages.forEach(p=> $("page-"+p).classList.remove("show"));
      $("page-"+name).classList.add("show");
    }
    function route(){
      const h = location.hash || "#/home";
      if(h.startsWith("#/pay")){
        showPage("pay");
        renderPay();
      } else if(h.startsWith("#/login")){
        showPage("login");
      } else {
        showPage("home");
      }
      renderTopButtons();
    }

    // ================ LOGIN ================
    function renderTopButtons(){
      const u = getUser();
      $("btnLogout").style.display = u ? "inline-flex" : "none";
      $("btnLoginTop").style.display = u ? "none" : "inline-flex";
      $("btnLoginHero").style.display = u ? "none" : "inline-flex";
      $("userTag").textContent = u ? `‚úÖ ${u.name} ‚Ä¢ Login` : "üîì Belum login";
    }
    function doLogin(){
      const name = $("inName").value.trim();
      const wa = $("inWa").value.trim();
      const pass = $("inPass").value.trim();
      if(!name || !wa || !pass){
        toast("Isi Nama, WhatsApp, Password dulu.");
        return;
      }
      setUser({name, wa, pass});
      toast("Login berhasil ‚úÖ");
      go("#/home");
      renderTopButtons();
      renderAdminStatus();
    }
    function logout(){
      clearUser();
      toast("Keluar ‚úÖ");
      go("#/home");
      renderTopButtons();
      renderAdminStatus();
    }

    // ================ PRODUCTS ================
    function minPrice(p){
      return Math.min(...p.variants.map(v=>v.price));
    }
    function renderProducts(){
      const q = ($("search")?.value || "").toLowerCase().trim();
      const list = products
        .filter(p=> !q || p.name.toLowerCase().includes(q))
        .sort((a,b)=> minPrice(a)-minPrice(b));

      $("countText").textContent = `${list.length} produk`;

      const wrap = $("productList");
      wrap.innerHTML = "";
      list.forEach(p=>{
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="thumb"><img src="${p.img}" alt="${escapeHtml(p.name)}"></div>
          <div class="cardBody">
            <h3>${escapeHtml(p.name)}</h3>
            <p>Klik Pesan untuk pilih paket & checkout</p>
            <div class="row">
              <div>
                <div class="mini">Mulai</div>
                <div class="price">${fmt(minPrice(p))}</div>
              </div>
              <button class="btn" style="padding:9px 11px;border-radius:14px" onclick="openProduct('${escapeAttr(p.name)}')">Pesan</button>
            </div>
          </div>
        `;
        wrap.appendChild(el);
      });
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])); }
    function escapeAttr(s){ return String(s).replace(/"/g, "&quot;"); }

    // ================ MODAL ================
    function openProduct(name){
      const p = products.find(x=>x.name===name);
      if(!p){ toast("Produk tidak ditemukan"); return; }
      currentProduct = p;
      currentVariant = null;
      $("mTitle").textContent = p.name;
      $("mImg").src = p.img;

      const list = $("mList");
      list.innerHTML = `
        <div class="mini" style="color:rgba(174,185,214,.9)">
          Pilih paket dulu:
        </div>
      `;
      p.variants.forEach(v=>{
        const item = document.createElement("div");
        item.className = "opt";
        item.onclick = ()=> chooseVariant(v);
        item.innerHTML = `
          <div>
            <b>${escapeHtml(v.label)}</b><br>
            <span>${escapeHtml(p.name)}</span>
          </div>
          <div class="rp">${fmt(v.price)}</div>
        `;
        list.appendChild(item);
      });

      $("overlay").classList.add("show");
    }
    function closeModal(e){
      if(e && e.target && e.target.id !== "overlay") return;
      $("overlay").classList.remove("show");
    }
    function chooseVariant(v){
      currentVariant = v;
      closeModal();
      startCheckout();
    }

    // ================ CHECKOUT / PAY ================
    function genTrxId(){
      const t = Date.now().toString(36).toUpperCase();
      const r = Math.random().toString(36).slice(2,7).toUpperCase();
      return `KIVO-${t}-${r}`;
    }

    function startCheckout(){
      if(!currentProduct || !currentVariant){
        toast("Pilih paket dulu.");
        return;
      }
      const u = getUser();
      if(!u){
        toast("Boleh checkout tanpa login, tapi lebih rapi kalau login.");
      }
      currentTrxId = genTrxId();

      // simpan order di localStorage (biar kalau refresh masih ada)
      const order = {
        trxId: currentTrxId,
        product: currentProduct.name,
        pack: currentVariant.label,
        price: currentVariant.price,
        createdAt: new Date().toISOString(),
        status: "PENDING"
      };
      localStorage.setItem("kivopay_last_order", JSON.stringify(order));

      go("#/pay");
    }

    function renderPay(){
      const order = safeJson(localStorage.getItem("kivopay_last_order"));
      const u = getUser();

      if(!order){
        toast("Belum ada order. Pilih produk dulu.");
        go("#/home");
        return;
      }

      $("trxMini").textContent = `ID: ${order.trxId}`;
      $("dName").textContent = u?.name || "‚Äî (belum login)";
      $("dWa").textContent = u?.wa || "‚Äî";
      $("dProd").textContent = order.product;
      $("dPack").textContent = order.pack;
      $("dPrice").textContent = fmt(order.price);

      const st = order.status || "PENDING";
      setPayStatus(st);
      // default method
      selectMethod(currentMethod);
    }

    function safeJson(s){
      try{ return JSON.parse(s||"null"); }catch{ return null; }
    }

    function setPayStatus(status){
      const el = $("payStatus");
      el.textContent = status;
      if(status === "LUNAS"){ el.style.color = "var(--ok)"; }
      else if(status === "GAGAL"){ el.style.color = "var(--bad)"; }
      else { el.style.color = "var(--warn)"; }
    }

    function selectMethod(m){
      currentMethod = m;
      ["dana","seabank","qris"].forEach(x=>{
        $("m-"+x).classList.toggle("active", x===m);
        $("pm-"+x).classList.toggle("show", x===m);
      });
    }

    function toggleQris(){
      const img = $("qrisImg");
      img.classList.toggle("show");
      toast(img.classList.contains("show") ? "QRIS ditampilkan" : "QRIS disembunyikan");
    }

    function copyText(txt){
      navigator.clipboard?.writeText(txt).then(()=>toast("Disalin ‚úÖ")).catch(()=>toast("Gagal copy. Copy manual ya."));
    }

    function buildWaMessage(){
      const u = getUser();
      const order = safeJson(localStorage.getItem("kivopay_last_order")) || {};
      const nama = u?.name || "";
      const produk = order.product || "";
      const pack = order.pack || "";
      const email = $("inEmail")?.value?.trim() || "";
      const durasi = $("inDur")?.value?.trim() || "";
      const lokasi = $("inLoc")?.value?.trim() || "";

      const text =
`Format Orderan KivoPay ‚ú®
Nama : ${nama}
Produk : ${produk}
Email Buyer : ${email}
Durasi & Device Buyer : ${durasi || pack}
Lokasi : ${lokasi}

ID Trx : ${order.trxId}
Total : ${fmt(order.price)}

Saya sudah melakukan pembayaran, mohon dicek ya kak üôè`;

      return text;
    }

    function sendToAdmin(){
      const msg = buildWaMessage();
      const url = CONFIG.adminWaLink + "?text=" + encodeURIComponent(msg);
      window.open(url, "_blank");
    }

    async function checkPaymentStatus(){
      const order = safeJson(localStorage.getItem("kivopay_last_order"));
      if(!order){ toast("Belum ada order."); return; }

      // Kalau ada endpoint asli, pakai ini:
      if(CONFIG.STATUS_ENDPOINT){
        try{
          toast("Cek status‚Ä¶");
          const res = await fetch(CONFIG.STATUS_ENDPOINT + encodeURIComponent(order.trxId), {cache:"no-store"});
          const data = await res.json();
          // harapannya: {status:"LUNAS"|"PENDING"|"GAGAL"}
          const st = (data?.status || "PENDING").toUpperCase();
          order.status = st;
          localStorage.setItem("kivopay_last_order", JSON.stringify(order));
          setPayStatus(st);
          toast("Status: " + st);
          return;
        }catch(e){
          toast("Gagal cek status (API).");
          return;
        }
      }

      // MODE DEMO (tanpa server)
      toast("Ini demo (tanpa server). Status tetap PENDING.");
      setPayStatus("PENDING");
    }

    // ================ INIT ================
    function initBrand(){
      $("brandName").textContent = CONFIG.appName;
      $("brandSub").textContent = CONFIG.appSubtitle;
      $("brandLogo").src = "https://images.bukaolshop.com/hosting/181218/f2f4904ff62a785161.png";
      document.title = CONFIG.appName;
    }

    window.addEventListener("hashchange", route);

    // typing 2 area (login & home)
    function initTyping(){
      startTyping($("typingText"), $("typingCursor"));
      startTyping($("typingTextHome"), $("typingCursorHome"));
    }

    // auto update status admin
    setInterval(renderAdminStatus, 25 * 1000);

    // start
    initBrand();
    initTyping();
    renderAdminStatus();
    route();
    renderProducts();
    renderTopButtons();
  </script>
</body>
</html>
